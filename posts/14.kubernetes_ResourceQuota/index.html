<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="[kubernetes-실습] ResourceQuota 사용 (PVC Count 와 Usage를 제한)" /><meta property="og:locale" content="en" /><meta name="description" content="kubernetes 인증 시험(CKA)에 대비하기 위해 실습을 해보도록 한다." /><meta property="og:description" content="kubernetes 인증 시험(CKA)에 대비하기 위해 실습을 해보도록 한다." /><link rel="canonical" href="https://ps2046.github.io/posts/14.kubernetes_ResourceQuota/" /><meta property="og:url" content="https://ps2046.github.io/posts/14.kubernetes_ResourceQuota/" /><meta property="og:site_name" content="ps’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-01-26T07:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[kubernetes-실습] ResourceQuota 사용 (PVC Count 와 Usage를 제한)" /><meta name="twitter:site" content="@ps2046" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"kubernetes 인증 시험(CKA)에 대비하기 위해 실습을 해보도록 한다.","headline":"[kubernetes-실습] ResourceQuota 사용 (PVC Count 와 Usage를 제한)","dateModified":"2021-08-26T00:00:00+09:00","url":"https://ps2046.github.io/posts/14.kubernetes_ResourceQuota/","datePublished":"2021-01-26T07:00:00+09:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://ps2046.github.io/posts/14.kubernetes_ResourceQuota/"},"@context":"https://schema.org"}</script><title>[kubernetes-실습] ResourceQuota 사용 (PVC Count 와 Usage를 제한) | ps's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ps's Blog"><meta name="application-name" content="ps's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7635228999568716" crossorigin="anonymous"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/11029548?s=400&u=5ebc191faa53e931968ec2ed98bd7c7b68136c71&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">ps's Blog</a></div><div class="site-subtitle font-italic">System Engineer & Developer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/ps2046" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/ps2046" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ps2046.jang','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[kubernetes-실습] ResourceQuota 사용 (PVC Count 와 Usage를 제한)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[kubernetes-실습] ResourceQuota 사용 (PVC Count 와 Usage를 제한)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> ps.jang </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Jan 26, 2021, 7:00 AM +0900" >Jan 26<i class="unloaded">2021-01-26T07:00:00+09:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, Aug 26, 2021, 12:00 AM +0000" >Aug 26<i class="unloaded">2021-08-26T00:00:00+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3657 words">20 min read</span></div></div><div class="post-content"><h2 id="기존-실습-리소스-정리">기존 실습 리소스 정리</h2><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>ps0107@k8smaster1:~<span class="nv">$ </span>kubectl delete deploy nginx-nfs
deployment.extensions <span class="s2">"nginx-nfs"</span> deleted

ps0107@k8smaster1:~<span class="nv">$ </span>kubectl delete pvc pvc-one 
persistentvolumeclaim <span class="s2">"pvc-one"</span> deleted

ps0107@k8smaster1:~<span class="nv">$ </span>kubectl delete pv pvvol-1
persistentvolume <span class="s2">"pvvol-1"</span> deleted
</pre></table></code></div></div><hr /><h2 id="resourcequota-설정-해보기">ResourceQuota 설정 해보기</h2><ul><li>ResourceQouta를 기본 설정으로 생성해 보자. 그리고 PV,PVC를 생성하여 어떻게 변경되는지 확인해 보자</ul><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre><td class="rouge-code"><pre><span class="c"># 해당 namespace 안에서는 500 Mi 까지가 최대, 10개까지만 허용.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>vi storage-quota.yaml 
apiVersion: v1
kind: ResourceQuota
metadata:
  name: storagequota
spec:
  hard:
    persistentvolumeclaims: <span class="s2">"10"</span>
    requests.storage: <span class="s2">"500Mi"</span>

<span class="c"># 테스트를 위한 small이라는 namespace 생성</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl create namespace small
namespace/small created

<span class="c"># 생성된 small ns의 상세 보기</span>
<span class="c"># resource quota, resource limits 가 현재 설정되어 있지 않음</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl describe ns small 
Name:         small
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Status:       Active

No resource quota.

No resource limits.

<span class="c"># PV 생성</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small create <span class="nt">-f</span> PVol.yaml                                                                            
persistentvolume/pvvol-1 created

<span class="c"># PVC 생성</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small create <span class="nt">-f</span> pvc.yaml 
persistentvolumeclaim/pvc-one created

<span class="c"># small namespace 에 ResourceQuota 설정</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small create <span class="nt">-f</span> storage-quota.yaml 
resourcequota/storagequota created

<span class="c"># 다시 small ns 자세히 보기로 확인</span>
<span class="c"># Resource Quotas가 설정되어 있다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl describe ns small 
Name:         small
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Status:       Active

Resource Quotas
 Name:                   storagequota
 Resource                Used   Hard
 <span class="nt">--------</span>                <span class="nt">---</span>    <span class="nt">---</span>
 persistentvolumeclaims  1      10
 requests.storage        200Mi  500Mi

No resource limits.
</pre></table></code></div></div><ul><li>deployment및 pod가 생성하여 어떻게 되는지 확인해 보자</ul><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
</pre><td class="rouge-code"><pre><span class="c"># deployment를 생성하기 위해 테스트 yaml파일 생성</span>
ps0107@k8smaster1:~<span class="nv">$ </span>vi nfs-pod.yaml 
apiVersion: apps/v1beta1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: <span class="s2">"1"</span>
  generation: 1
  labels:
    run: nginx
  name: nginx-nfs
  resourceVersion: <span class="s2">"1411"</span>
spec:
  replicas: 1
  selector:
    matchLabels:
      run: nginx
  strategy:
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 1
    <span class="nb">type</span>: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      labels:
        run: nginx
    spec:
      containers:
      - image: nginx
        imagePullPolicy: Always
        name: nginx
        volumeMounts:
        - name: nfs-vol
          mountPath: /opt
        ports:
        - containerPort: 80
          protocol: TCP
        resources: <span class="o">{}</span>
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
      volumes:                           
      - name: nfs-vol
        persistentVolumeClaim:
          claimName: pvc-one
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: <span class="o">{}</span>
      terminationGracePeriodSeconds: 30

<span class="c"># deployment 생성</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small create <span class="nt">-f</span> nfs-pod.yaml                                                                         
deployment.apps/nginx-nfs created

<span class="c"># 생성된 deployment 확인</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl get deploy <span class="nt">--namespace</span><span class="o">=</span>small                                                                            
NAME        READY   UP-TO-DATE   AVAILABLE   AGE
nginx-nfs   1/1     1            1           19s

<span class="c"># 생성된 deployment 상세 확인</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small describe deploy nginx-nfs
Name:                   nginx-nfs
Namespace:              small
CreationTimestamp:      Tue, 04 Feb 2020 01:59:35 +0000
Labels:                 <span class="nv">run</span><span class="o">=</span>nginx
Annotations:            deployment.kubernetes.io/revision: 1
Selector:               <span class="nv">run</span><span class="o">=</span>nginx
Replicas:               1 desired | 1 updated | 1 total | 1 available | 0 unavailable
StrategyType:           RollingUpdate
MinReadySeconds:        0
RollingUpdateStrategy:  1 max unavailable, 1 max surge
Pod Template:
  Labels:  <span class="nv">run</span><span class="o">=</span>nginx
  Containers:
   nginx:
    Image:        nginx
    Port:         80/TCP
    Host Port:    0/TCP
    Environment:  &lt;none&gt;
    Mounts:
      /opt from nfs-vol <span class="o">(</span>rw<span class="o">)</span>
  Volumes:
   nfs-vol:
    Type:       PersistentVolumeClaim <span class="o">(</span>a reference to a PersistentVolumeClaim <span class="k">in </span>the same namespace<span class="o">)</span>
    ClaimName:  pvc-one
    ReadOnly:   <span class="nb">false
</span>Conditions:
  Type           Status  Reason
  <span class="nt">----</span>           <span class="nt">------</span>  <span class="nt">------</span>
  Available      True    MinimumReplicasAvailable
  Progressing    True    NewReplicaSetAvailable
OldReplicaSets:  &lt;none&gt;
NewReplicaSet:   nginx-nfs-86845f4d55 <span class="o">(</span>1/1 replicas created<span class="o">)</span>
Events:
  Type    Reason             Age   From                   Message
  <span class="nt">----</span>    <span class="nt">------</span>             <span class="nt">----</span>  <span class="nt">----</span>                   <span class="nt">-------</span>
  Normal  ScalingReplicaSet  39s   deployment-controller  Scaled up replica <span class="nb">set </span>nginx-nfs-86845f4d55 to 1

<span class="c"># pod 확인</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small get pod
NAME                         READY   STATUS    RESTARTS   AGE
nginx-nfs-86845f4d55-2srr8   1/1     Running   0          57s

<span class="c"># 생성된 pod 상세 확인</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small describe pod nginx-nfs-86845f4d55-2srr8 
Name:           nginx-nfs-86845f4d55-2srr8
Namespace:      small
Priority:       0
Node:           k8sworker1/10.146.0.4
Start Time:     Tue, 04 Feb 2020 01:59:35 +0000
Labels:         pod-template-hash<span class="o">=</span>86845f4d55
                <span class="nv">run</span><span class="o">=</span>nginx
Annotations:    cni.projectcalico.org/podIP: 192.168.1.85/32
Status:         Running
IP:             192.168.1.85
Controlled By:  ReplicaSet/nginx-nfs-86845f4d55
Containers:
  nginx:
    Container ID:   docker://21459d9797d5bfed49b1cdb10817e3236b73fd6089c5feaf299c627c6434d63f
    Image:          nginx
    Image ID:       docker-pullable://nginx@sha256:ad5552c786f128e389a0263104ae39f3d3c7895579d45ae716f528185b36bc6f
    Port:           80/TCP
    Host Port:      0/TCP
    State:          Running
      Started:      Tue, 04 Feb 2020 01:59:39 +0000
    Ready:          True
    Restart Count:  0
    Environment:    &lt;none&gt;
    Mounts:
      /opt from nfs-vol <span class="o">(</span>rw<span class="o">)</span>
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-g9bxk <span class="o">(</span>ro<span class="o">)</span>
Conditions:
  Type              Status
  Initialized       True 
  Ready             True 
  ContainersReady   True 
  PodScheduled      True 
Volumes:
  nfs-vol:
    Type:       PersistentVolumeClaim <span class="o">(</span>a reference to a PersistentVolumeClaim <span class="k">in </span>the same namespace<span class="o">)</span>
    ClaimName:  pvc-one
    ReadOnly:   <span class="nb">false
  </span>default-token-g9bxk:
    Type:        Secret <span class="o">(</span>a volume populated by a Secret<span class="o">)</span>
    SecretName:  default-token-g9bxk
    Optional:    <span class="nb">false
</span>QoS Class:       BestEffort
Node-Selectors:  &lt;none&gt;
Tolerations:     node.kubernetes.io/not-ready:NoExecute <span class="k">for </span>300s
                 node.kubernetes.io/unreachable:NoExecute <span class="k">for </span>300s
Events:
  Type    Reason     Age   From                 Message
  <span class="nt">----</span>    <span class="nt">------</span>     <span class="nt">----</span>  <span class="nt">----</span>                 <span class="nt">-------</span>
  Normal  Scheduled  71s   default-scheduler    Successfully assigned small/nginx-nfs-86845f4d55-2srr8 to k8sworker1
  Normal  Pulling    70s   kubelet, k8sworker1  Pulling image <span class="s2">"nginx"</span>
  Normal  Pulled     67s   kubelet, k8sworker1  Successfully pulled image <span class="s2">"nginx"</span>
  Normal  Created    67s   kubelet, k8sworker1  Created container nginx
  Normal  Started    67s   kubelet, k8sworker1  Started container nginx

<span class="c"># small namespace 확인</span>
<span class="c"># resource quota 부분을 보면, 현재 1개 사용중이고, 200Mi 사용중인걸 확인 할 수 있다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl describe ns small 
Name:         small
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Status:       Active

Resource Quotas
 Name:                   storagequota
 Resource                Used   Hard
 <span class="nt">--------</span>                <span class="nt">---</span>    <span class="nt">---</span>
 persistentvolumeclaims  1      10
 requests.storage        200Mi  500Mi

No resource limits.
</pre></table></code></div></div><ul><li>이번엔 해당 host에서 /opt/sfw 안에 300M 파일을 생성하고, quota usage를 다시 확인해 본다</ul><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="c"># 해당 host에서 /opt/sfw 안에 300M 파일을 생성하고, quota usage를 다시 본다. </span>
ps0107@k8smaster1:~<span class="nv">$ </span><span class="nb">sudo dd </span><span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>/opt/sfw/bigfile <span class="nv">bs</span><span class="o">=</span>1M <span class="nv">count</span><span class="o">=</span>300
300+0 records <span class="k">in
</span>300+0 records out
314572800 bytes <span class="o">(</span>315 MB, 300 MiB<span class="o">)</span> copied, 0.641641 s, 490 MB/s

<span class="c"># 기존 설정 그래도 보인다.</span>
<span class="c"># nfs의 경우는 공유크기가 deployment에 대해 계산되지 않는다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl describe ns small 
Name:         small
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Status:       Active

Resource Quotas
 Name:                   storagequota
 Resource                Used   Hard
 <span class="nt">--------</span>                <span class="nt">---</span>    <span class="nt">---</span>
 persistentvolumeclaims  1      10
 requests.storage        200Mi  500Mi

No resource limits.

ps0107@k8smaster1:~<span class="nv">$ </span><span class="nb">du</span> <span class="nt">-h</span> /opt/
<span class="nb">du</span>: cannot <span class="nb">read </span>directory <span class="s1">'/opt/containerd'</span>: Permission denied
4.0K/opt/containerd
301M/opt/sfw
101M/opt/cni/bin
101M/opt/cni
401M/opt/
</pre></table></code></div></div><ul><li>이제 deployment가 할당량보다 더 많이 요청하면 어떻게 되는지 살펴본다.</ul><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="c"># ----------------------------------------------</span>
<span class="c"># 이제 deployment가 할당량보다 더 많이 요청하면 어떻게 되는지 살펴본다.</span>
<span class="c"># ----------------------------------------------</span>
<span class="c"># 삭제하기 위해 현재 deployment를 조회한다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small get deploy
NAME        READY   UP-TO-DATE   AVAILABLE   AGE
nginx-nfs   1/1     1            1           4m39s

<span class="c"># 기존 deployment 삭제</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small delete deploy nginx-nfs
deployment.extensions <span class="s2">"nginx-nfs"</span> deleted

<span class="c"># 기존 deployment 삭제하면서 pod 를 shutdown 시켰고, </span>
<span class="c"># 다시 한번 small namespace를 확인해보면 storage가 보존(retain)되어 있음을 확인할수 있다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl describe ns small
Name:         small
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Status:       Active

Resource Quotas
 Name:                   storagequota
 Resource                Used   Hard
 <span class="nt">--------</span>                <span class="nt">---</span>    <span class="nt">---</span>
 persistentvolumeclaims  1      10
 requests.storage        200Mi  500Mi

No resource limits.
</pre></table></code></div></div><ul><li>이번에는 pvc를 삭제 해보고, pv 정보를 확인해 본다.</ul><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="c"># ----------------------------------------------------</span>
<span class="c"># 이번에는 pvc를 삭제 해보고, pv 정보를 확인해 본다. </span>
<span class="c"># ----------------------------------------------------</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small get pvc
NAME      STATUS   VOLUME    CAPACITY   ACCESS MODES   STORAGECLASS   AGE
pvc-one   Bound    pvvol-1   1Gi        RWX                           9m58s

<span class="c"># pvc를 삭제</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small delete pvc pvc-one
persistentvolumeclaim <span class="s2">"pvc-one"</span> deleted

<span class="c"># pv 정보를 확인</span>
<span class="c"># RECLAIMPOLICY, STATUS를 보면 Retain, Released 상태임을 알수 있다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small get pv
NAME      CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS     CLAIM           STORAGECLASS   REASON   AGE
pvvol-1   1Gi        RWX            Retain           Released   small/pvc-one                           10m
</pre></table></code></div></div><ul><li>이번엔 persistentVolumeReclaimPolicy 설정을 바꾸어 보며 테스트 해보자.</ul><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
</pre><td class="rouge-code"><pre><span class="c"># ----------------------------------------------</span>
<span class="c"># 이번엔 persistentVolumeReclaimPolicy 설정을 바꾸어 보자.</span>
<span class="c"># ----------------------------------------------</span>
<span class="c"># 현재 설정된 pv 객체에 대한 정보를 yaml형태로 보면 기본값이 Retain 임을 알수 있다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl get pv/pvvol-1 <span class="nt">-o</span> yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  annotations:
    pv.kubernetes.io/bound-by-controller: <span class="s2">"yes"</span>
  creationTimestamp: <span class="s2">"2020-02-04T01:54:52Z"</span>
  finalizers:
  - kubernetes.io/pv-protection
  name: pvvol-1
  resourceVersion: <span class="s2">"780598"</span>
  selfLink: /api/v1/persistentvolumes/pvvol-1
  uid: a381b18a-da86-404a-90c8-215dac88d384
spec:
  accessModes:
  - ReadWriteMany
  capacity:
    storage: 1Gi
  claimRef:
    apiVersion: v1
    kind: PersistentVolumeClaim
    name: pvc-one
    namespace: small
    resourceVersion: <span class="s2">"779741"</span>
    uid: 5d15e744-1810-4a82-9661-9930a92ed3d4
  nfs:
    path: /opt/sfw
    server: k8smaster
  persistentVolumeReclaimPolicy: Retain <span class="c"># &lt;-- 기본 값은 Retain 임을 알수 있다.</span>
  volumeMode: Filesystem
status:
  phase: Released

<span class="c"># 다시 생성하기 위해 object들을 삭제 한다.</span>
<span class="c"># pv 삭제</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl delete pv/pvvol-1
persistentvolume <span class="s2">"pvvol-1"</span> deleted

<span class="c"># yaml 파일에서 persistentVolumeReclaimPolicy 부분을 확인한다.</span>
<span class="c"># 현재 Retain 으로 설정되어 있다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span><span class="nb">grep </span>Retain PVol.yaml 
  persistentVolumeReclaimPolicy: Retain

<span class="c"># PV를 생성한다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl create <span class="nt">-f</span> PVol.yaml 
persistentvolume/pvvol-1 created

<span class="c"># persistentVolumeReclaimPolicy를 Delete 상태로 수정한다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl patch pv pvvol-1 <span class="nt">-p</span> <span class="s1">'{"spec":{"persistentVolumeReclaimPolicy":"Delete"}}'</span>
persistentvolume/pvvol-1 patched

<span class="c"># patch된 pv 상태를 확인한다.</span>
<span class="c"># RECLAIMPOLICY 항목이 Delete로 수정되어 있음을 확인</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl get pv/pvvol-1
NAME      CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE
pvvol-1   1Gi        RWX            Delete           Available                                   63s

<span class="c"># 현재 Resource Quota 설정을 확인 한다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl describe ns small
Name:         small
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Status:       Active

Resource Quotas
 Name:                   storagequota
 Resource                Used  Hard
 <span class="nt">--------</span>                <span class="nt">---</span>   <span class="nt">---</span>
 persistentvolumeclaims  0     10
 requests.storage        0     500Mi

No resource limits.

<span class="c"># pvc를 다시 생성해 본다.</span>
<span class="c"># 실행중인 pod 가 없은 경우에도 resource usage를 기록하고 있다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small create <span class="nt">-f</span> pvc.yaml 
persistentvolumeclaim/pvc-one created

<span class="c"># requests.storage 라인을 보면 확인 할수 있다</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl describe ns small
Name:         small
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Status:       Active

Resource Quotas
 Name:                   storagequota
 Resource                Used   Hard
 <span class="nt">--------</span>                <span class="nt">---</span>    <span class="nt">---</span>
 persistentvolumeclaims  1      10
 requests.storage        200Mi  500Mi

No resource limits.

<span class="c"># namespace에 있는 resourcequota를 삭제해보자.</span>
<span class="c"># resourcequota를 조회 해본다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small get resourcequota
NAME           CREATED AT
storagequota   2020-02-04T01:55:18Z

<span class="c"># 조회된 resourcequota를 삭제한다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small delete resourcequota storagequota
resourcequota <span class="s2">"storagequota"</span> deleted

<span class="c"># resourcequota 의 capacity를 100Mi로 수정한다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>vi storage-quota.yaml 
apiVersion: v1
kind: ResourceQuota
metadata:
  name: storagequota
spec:
  hard:
    persistentvolumeclaims: <span class="s2">"10"</span>
    requests.storage: <span class="s2">"100Mi"</span>

<span class="c"># 새로운 storage quota를 검증후 생성한다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small create <span class="nt">-f</span> storage-quota.yaml
resourcequota/storagequota created

<span class="c"># hard limit이 이미 초과 된걸로 확인된다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl describe ns small 
Name:         small
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Status:       Active

Resource Quotas
 Name:                   storagequota
 Resource                Used   Hard
 <span class="nt">--------</span>                <span class="nt">---</span>    <span class="nt">---</span>
 persistentvolumeclaims  1      10
 requests.storage        200Mi  100Mi

No resource limits.

<span class="c"># deployment를 다시 생성해 본다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl create <span class="nt">-f</span> nfs-pod.yaml <span class="nt">-n</span> small 
deployment.apps/nginx-nfs created

<span class="c"># deployment 정보를 보면 error가 없다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small describe deploy/nginx-nfs
Name:                   nginx-nfs
Namespace:              small
CreationTimestamp:      Tue, 04 Feb 2020 02:11:27 +0000
Labels:                 <span class="nv">run</span><span class="o">=</span>nginx
Annotations:            deployment.kubernetes.io/revision: 1
Selector:               <span class="nv">run</span><span class="o">=</span>nginx
Replicas:               1 desired | 1 updated | 1 total | 1 available | 0 unavailable
StrategyType:           RollingUpdate
MinReadySeconds:        0
RollingUpdateStrategy:  1 max unavailable, 1 max surge
Pod Template:
  Labels:  <span class="nv">run</span><span class="o">=</span>nginx
  Containers:
   nginx:
    Image:        nginx
    Port:         80/TCP
    Host Port:    0/TCP
    Environment:  &lt;none&gt;
    Mounts:
      /opt from nfs-vol <span class="o">(</span>rw<span class="o">)</span>
  Volumes:
   nfs-vol:
    Type:       PersistentVolumeClaim <span class="o">(</span>a reference to a PersistentVolumeClaim <span class="k">in </span>the same namespace<span class="o">)</span>
    ClaimName:  pvc-one
    ReadOnly:   <span class="nb">false
</span>Conditions:
  Type           Status  Reason
  <span class="nt">----</span>           <span class="nt">------</span>  <span class="nt">------</span>
  Available      True    MinimumReplicasAvailable
  Progressing    True    NewReplicaSetAvailable
OldReplicaSets:  &lt;none&gt;
NewReplicaSet:   nginx-nfs-86845f4d55 <span class="o">(</span>1/1 replicas created<span class="o">)</span>
Events:
  Type    Reason             Age   From                   Message
  <span class="nt">----</span>    <span class="nt">------</span>             <span class="nt">----</span>  <span class="nt">----</span>                   <span class="nt">-------</span>
  Normal  ScalingReplicaSet  21s   deployment-controller  Scaled up replica <span class="nb">set </span>nginx-nfs-86845f4d55 to 1

<span class="c"># pod가 실제 running중인지 확인한다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small get po
NAME                         READY   STATUS    RESTARTS   AGE
nginx-nfs-86845f4d55-krbll   1/1     Running   0          45s

<span class="c"># ----------------------------------------------</span>
<span class="c"># 겉보기에는 하드 할당량이 설정되어 있었음에도 불구하고 더 많은 pod를 배치할 수 있었다. </span>
<span class="c"># 스토리지 재확보가 가능한지 테스트해 보자. 먼저 deployment 및 pvc을 제거한다.</span>
<span class="c"># ----------------------------------------------</span>
<span class="c"># deployment 제거</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small delete deploy nginx-nfs
deployment.extensions <span class="s2">"nginx-nfs"</span> deleted

<span class="c"># pvc 제거</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small delete pvc/pvc-one
persistentvolumeclaim <span class="s2">"pvc-one"</span> deleted

<span class="c"># PV를 확인합니다. 제거 시도를 했지만 실패했음을 알 수 있습니다. </span>
<span class="c"># 자세히 보면 NFS용 Delector Volume plugin의 부족과 관련된 오류가 나타납니다. </span>
<span class="c"># 다른 스토리지 프로토콜들은 플러그인을 가지고 있다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small get pv
NAME      CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM           STORAGECLASS   REASON   AGE
pvvol-1   1Gi        RWX            Delete           Failed   small/pvc-one                           6m51s

<span class="c"># pv 제거 후 deployment, pv, pvc 모두 제거 되었는지 확인한다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl delete pv/pvvol-1
persistentvolume <span class="s2">"pvvol-1"</span> deleted

<span class="c"># PV를 만들기 위해 yaml 파일 생성 </span>
<span class="c"># persistentVolumeReclaimPolicy: Recycle로 수정</span>
ps0107@k8smaster1:~<span class="nv">$ </span>vi PVol.yaml 
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pvvol-1
spec:
  capacity:
    storage: 1Gi
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Recycle
  nfs:
    path: /opt/sfw
    server: k8smaster
    readOnly: <span class="nb">false</span>

<span class="c"># LimitRange 설정을 위해 yaml 파일을 생성한다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>vi low-resource-range.yaml
apiVersion: v1
kind: LimitRange
metadata:
  name: low-resource-range
spec:
  limits:
  - default:
      cpu: 1
      memory: 500Mi
    defaultRequest:
      cpu: 0.5
      memory: 100Mi
    <span class="nb">type</span>: Container

<span class="c"># small namespace에 LimitRange 설정한다. </span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small create <span class="nt">-f</span> low-resource-range.yaml
limitrange/low-resource-range created

<span class="c"># small namespace를 확인한다.</span>
<span class="c"># Resource Quotas과 Resource Limits 설정을 둘다 볼수 있다</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl describe ns small 
Name:         small
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Status:       Active

Resource Quotas
 Name:                   storagequota
 Resource                Used  Hard
 <span class="nt">--------</span>                <span class="nt">---</span>   <span class="nt">---</span>
 persistentvolumeclaims  0     10
 requests.storage        0     100Mi

Resource Limits
 Type       Resource  Min  Max  Default Request  Default Limit  Max Limit/Request Ratio
 <span class="nt">----</span>       <span class="nt">--------</span>  <span class="nt">---</span>  <span class="nt">---</span>  <span class="nt">---------------</span>  <span class="nt">-------------</span>  <span class="nt">-----------------------</span>
 Container  cpu       -    -    500m             1              -
 Container  memory    -    -    100Mi            500Mi          -

<span class="c"># pv 생성</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small create <span class="nt">-f</span> PVol.yaml 
persistentvolume/pvvol-1 created

<span class="c"># 생성된 pv 상태 확인</span>
<span class="c"># RECLAIM POLICY가 Recycle로 생성 됨을 확인 할수 있다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl get pv
NAME      CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE
pvvol-1   1Gi        RWX            Recycle          Available                                   6s

<span class="c"># 다시 pvc 생성을 시도해본다.Error가 발생한다.</span>
<span class="c"># !!!!!! quota 는 resource limit 적용되는 경우에만 적용된다 !!!!!</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small create <span class="nt">-f</span> pvc.yaml 
Error from server <span class="o">(</span>Forbidden<span class="o">)</span>: error when creating <span class="s2">"pvc.yaml"</span>: 
persistentvolumeclaims <span class="s2">"pvc-one"</span> is forbidden: exceeded quota: 
storagequota, requested: requests.storage<span class="o">=</span>200Mi, used: 
requests.storage<span class="o">=</span>0, limited: requests.storage<span class="o">=</span>100Mi

<span class="c"># resourcequota의 request.storage 를 500 Mi 로 수정한다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small edit resourcequotas
resourcequota/storagequota edited

<span class="c"># 다시 pvc 생성을 시도해본다.</span>
<span class="c"># 이번에는 pvc가 잘 생성되었다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small create <span class="nt">-f</span> pvc.yaml
persistentvolumeclaim/pvc-one created

<span class="c"># deployment도 잘 생성이 된다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small create <span class="nt">-f</span> nfs-pod.yaml
deployment.apps/nginx-nfs created

<span class="c"># 이제 small namespace를 확인해본다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl describe ns small 
Name:         small
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Status:       Active

Resource Quotas
 Name:                   storagequota
 Resource                Used   Hard
 <span class="nt">--------</span>                <span class="nt">---</span>    <span class="nt">---</span>
 persistentvolumeclaims  1      10
 requests.storage        200Mi  500Mi

Resource Limits
 Type       Resource  Min  Max  Default Request  Default Limit  Max Limit/Request Ratio
 <span class="nt">----</span>       <span class="nt">--------</span>  <span class="nt">---</span>  <span class="nt">---</span>  <span class="nt">---------------</span>  <span class="nt">-------------</span>  <span class="nt">-----------------------</span>
 Container  memory    -    -    100Mi            500Mi          -
 Container  cpu       -    -    500m             1              -

<span class="c"># deployment를 삭제한 후 PV, PVC 상태를 확인해보자</span>
<span class="c"># deployment 삭제</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small delete deploy nginx-nfs
deployment.extensions <span class="s2">"nginx-nfs"</span> deleted

<span class="c"># pvc 상태 확인</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small get pvc
NAME      STATUS   VOLUME    CAPACITY   ACCESS MODES   STORAGECLASS   AGE
pvc-one   Bound    pvvol-1   1Gi        RWX                           44s

<span class="c"># pv 상태 확인</span>
<span class="c"># RECLAIM POLICY : Recycle</span>
<span class="c"># STATUS : Bound</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small get pv
NAME      CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM           STORAGECLASS   REASON   AGE
pvvol-1   1Gi        RWX            Recycle          Bound    small/pvc-one                           2m16s

<span class="c"># pvc를 삭제 한뒤 pv 상태를 확인 한다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small delete pvc pvc-one
persistentvolumeclaim <span class="s2">"pvc-one"</span> deleted

<span class="c"># pv 상태 확인</span>
<span class="c"># RECLAIM POLICY : Recycle</span>
<span class="c"># STATUS : Available</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> small get pv
NAME      CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE
pvvol-1   1Gi        RWX            Recycle          Available                                   2m33s
</pre></table></code></div></div><h2 id="리소스-정리">리소스 정리</h2><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="c"># 테스트가 끝났으니 resource를 정리한다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl delete pv pvvol-1 
persistentvolume <span class="s2">"pvvol-1"</span> deleted
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/kubernetes/'>Kubernetes</a>, <a href='/categories/kubernetes-administration-course/'>Kubernetes Administration Course</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >kubernetes</a> <a href="/tags/cka/" class="post-tag no-text-decoration" >cka</a> <a href="/tags/lfs458/" class="post-tag no-text-decoration" >LFS458</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[kubernetes-실습] ResourceQuota 사용 (PVC Count 와 Usage를 제한) - ps's Blog&url=https://ps2046.github.io/posts/14.kubernetes_ResourceQuota/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[kubernetes-실습] ResourceQuota 사용 (PVC Count 와 Usage를 제한) - ps's Blog&u=https://ps2046.github.io/posts/14.kubernetes_ResourceQuota/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=[kubernetes-실습] ResourceQuota 사용 (PVC Count 와 Usage를 제한) - ps's Blog&url=https://ps2046.github.io/posts/14.kubernetes_ResourceQuota/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/blog-comments-utterances/">[blog] github blog comments (utterances)</a><li><a href="/posts/17.kubernetes_Scheduling_2/">[kubernetes-실습] Scheduling - Taint를 이용한 pod 배포 관리</a><li><a href="/posts/18.kubernetes_logging_trubleshooting_1/">[kubernetes-실습] 로깅과 트러블슈팅 : 로그위치와 로그 출력 보기</a><li><a href="/posts/19.kubernetes_logging_trubleshooting_2/">[kubernetes-실습] 로깅과 트러블슈팅 : Metrics와 DashBoard</a><li><a href="/posts/20.kubernetes_crd/">[kubernetes-실습] CRD (Custom Resource Definition)</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cka/">cka</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/lfs458/">LFS458</a> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/comments/">comments</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/monitoring/">monitoring</a> <a class="post-tag" href="/tags/system/">system</a> <a class="post-tag" href="/tags/utterances/">utterances</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/17.kubernetes_Scheduling_2/"><div class="card-body"> <span class="timeago small" >Jan 26<i class="unloaded">2021-01-26T08:30:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[kubernetes-실습] Scheduling - Taint를 이용한 pod 배포 관리</h3><div class="text-muted small"><p> Using Taints to Control Pod Deployment taints를 사용하여 어느곳에 pod가 배치되거나 실행을 허용하도록 관리할수 있다. 노드 그룹에 pod들을 할당하여 추가할때 노드 사용을 제한하거나 pod들을 완전히 대피시킬수 있다. 참고 마스터노드가 처음에 NoSchedule taint로 설정되어 있었던것을 기억할 것이다...</p></div></div></a></div><div class="card"> <a href="/posts/18.kubernetes_logging_trubleshooting_1/"><div class="card-body"> <span class="timeago small" >Jan 26<i class="unloaded">2021-01-26T09:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[kubernetes-실습] 로깅과 트러블슈팅 : 로그위치와 로그 출력 보기</h3><div class="text-muted small"><p> 로그 파일들의 위치 알아보기 다양한 로그 파일과 명령 출력 이외에도 journalctl을 사용하여 노드 관점에서 로그를 볼 수 있다. 우리는 로그 파일의 공통적인 위치를 보고, 컨테이너 로그를 보는 명령을 볼 것이다. 다른 컨테이너의 로그를 pod에 적재하는데 전용으로 사용되는 sidecar container의 사용과 같은 다른 로깅 ...</p></div></div></a></div><div class="card"> <a href="/posts/19.kubernetes_logging_trubleshooting_2/"><div class="card-body"> <span class="timeago small" >Jan 26<i class="unloaded">2021-01-26T10:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[kubernetes-실습] 로깅과 트러블슈팅 : Metrics와 DashBoard</h3><div class="text-muted small"><p> Metrics 설정 heapster가 deprecation 되면서 Metrics Server 와 통합되어 개발되고 배포되어지고 있다. 그리고 CNCF의 프로젝트중 프로메테우스도 잘 사용되어지고 있다. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 3...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/13.kubernetes_PV_PVC/" class="btn btn-outline-primary" prompt="Older"><p>[kubernetes-실습] PV 와 PVC 생성</p></a> <a href="/posts/15.kubernetes_ingress/" class="btn btn-outline-primary" prompt="Newer"><p>[kubernetes-실습] ingress 간단 실습</p></a></div><script src="https://utteranc.es/client.js" repo="ps2046/ps2046-github-io-comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async> </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://ps2046.github.io">ps.jang</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/cka/">cka</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/lfs458/">LFS458</a> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/comments/">comments</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/monitoring/">monitoring</a> <a class="post-tag" href="/tags/system/">system</a> <a class="post-tag" href="/tags/utterances/">utterances</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://ps2046.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-158837927-2"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-158837927-2'); }); </script>
