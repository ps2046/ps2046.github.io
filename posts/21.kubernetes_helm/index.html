<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="[kubernetes-실습] helm" /><meta property="og:locale" content="en" /><meta name="description" content="kubernetes 인증 시험(CKA)에 대비하기 위해 실습을 해보도록 한다." /><meta property="og:description" content="kubernetes 인증 시험(CKA)에 대비하기 위해 실습을 해보도록 한다." /><link rel="canonical" href="https://ps2046.github.io/posts/21.kubernetes_helm/" /><meta property="og:url" content="https://ps2046.github.io/posts/21.kubernetes_helm/" /><meta property="og:site_name" content="ps’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-01-26T12:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[kubernetes-실습] helm" /><meta name="twitter:site" content="@ps2046" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"kubernetes 인증 시험(CKA)에 대비하기 위해 실습을 해보도록 한다.","headline":"[kubernetes-실습] helm","dateModified":"2021-08-26T00:00:00+09:00","url":"https://ps2046.github.io/posts/21.kubernetes_helm/","datePublished":"2021-01-26T12:00:00+09:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://ps2046.github.io/posts/21.kubernetes_helm/"},"@context":"https://schema.org"}</script><title>[kubernetes-실습] helm | ps's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ps's Blog"><meta name="application-name" content="ps's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7635228999568716" crossorigin="anonymous"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/11029548?s=400&u=5ebc191faa53e931968ec2ed98bd7c7b68136c71&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">ps's Blog</a></div><div class="site-subtitle font-italic">System Engineer & Developer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/ps2046" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/ps2046" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ps2046.jang','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[kubernetes-실습] helm</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[kubernetes-실습] helm</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> ps.jang </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Jan 26, 2021, 12:00 PM +0900" >Jan 26<i class="unloaded">2021-01-26T12:00:00+09:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, Aug 26, 2021, 12:00 AM +0000" >Aug 26<i class="unloaded">2021-08-26T00:00:00+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4959 words">27 min read</span></div></div><div class="post-content"><h2 id="helm">helm</h2><ol><li>복잡한 어플리케이션들을 배포할때 사용하며, yum 이나 apt와 비슷하게 쿠버네티스 안의 package manager 역할을 한다.<li>chart template을 통해서 kubenetes application 을 패키징한다.<li>helm은 chart의 install을 요청하는 client 이다.<li>chart에 따라서 Tiller(서버) 가 cluster resource들을 생성한다.</ol><h2 id="helm과-tiller">helm과 Tiller</h2><p>helm은 로컬에 설치한 client를 말하고 Tiller는 쿠버네티스 클러스터 안에서 실행 중인 서버이다.</p><h2 id="helm-과-charts">Helm 과 Charts</h2><p>helm 을 사용하면 복잡한 구성을 쉽게 구현할 수 있다. multi-part 애플리케이션을 한 번에 deployment 할 수 있다. Chart 또는 템플릿 파일을 사용하면 필요한 구성 요소와 해당 관계가 선언된다. tiller와 같은 로컬 에이전트는 API를 사용하여 사용자를 대신하여 object를 생성한다. 효과적으로 오케스트레이션할 수 있다. 이번 실습에서는 helm을 설치하고 클러스터에서 Maria DB를 구성하는 chart를 배포해 보도록 한다.</p><h2 id="helm-install">Helm install</h2><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
</pre><td class="rouge-code"><pre><span class="c"># -------------------------------------------------------</span>
<span class="c"># helm setup</span>
<span class="c"># -------------------------------------------------------</span>
<span class="c"># helm install</span>
ps0107@k8smaster1:~<span class="nv">$ </span>curl https://raw.githubusercontent.com/helm/helm/master/scripts/get | bash
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  7164  100  7164    0     0  18119      0 <span class="nt">--</span>:--:-- <span class="nt">--</span>:--:-- <span class="nt">--</span>:--:-- 18136
Downloading https://get.helm.sh/helm-v2.16.1-linux-amd64.tar.gz
Preparing to <span class="nb">install </span>helm and tiller into /usr/local/bin
helm installed into /usr/local/bin/helm
tiller installed into /usr/local/bin/tiller
Run <span class="s1">'helm init'</span> to configure helm.

<span class="c"># 새로운 RBAC 구성으로 인해 helm은 이 버전의 kubernetes에서 default namespace 에서 실행할 수 없습니다. initalization 중에 새로운 namespace를 생성하고 선언할 수 있습니다. 다른 RBAC 이슈는 그때도 발생할 수 있습니다. 이번 실습에서는 tiller를 위한 service account를 생성하고 클러스터에 대한 관리 기능을 제공합니다. </span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl create serviceaccount <span class="nt">--namespace</span> kube-system tiller
serviceaccount/tiller created

<span class="c"># kube-system namespace안에 cluster-admin 이라는 이름으로 admin role으로 serviceaccount를 바인드한다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl create clusterrolebinding tiller-cluster-rule <span class="nt">--clusterrole</span><span class="o">=</span>cluster-admin <span class="nt">--serviceaccount</span><span class="o">=</span>kube-system:tiller
clusterrolebinding.rbac.authorization.k8s.io/tiller-cluster-rule created

<span class="c"># helm init</span>
ps0107@k8smaster1:~<span class="nv">$ </span>helm init <span class="nt">--service-account</span> tiller
Creating /home/ps0107/.helm
Creating /home/ps0107/.helm/repository
Creating /home/ps0107/.helm/repository/cache
Creating /home/ps0107/.helm/repository/local
Creating /home/ps0107/.helm/plugins
Creating /home/ps0107/.helm/starters
Creating /home/ps0107/.helm/cache/archive
Creating /home/ps0107/.helm/repository/repositories.yaml
Adding stable repo with URL: https://kubernetes-charts.storage.googleapis.com
Adding <span class="nb">local </span>repo with URL: http://127.0.0.1:8879/charts
<span class="nv">$HELM_HOME</span> has been configured at /home/ps0107/.helm.

Tiller <span class="o">(</span>the Helm server-side component<span class="o">)</span> has been installed into your Kubernetes Cluster.

Please note: by default, Tiller is deployed with an insecure <span class="s1">'allow unauthenticated users'</span> policy.
To prevent this, run <span class="sb">`</span>helm init<span class="sb">`</span> with the <span class="nt">--tiller-tls-verify</span> flag.
For more information on securing your installation see: https://docs.helm.sh/using_helm/#securing-your-helm-installation

<span class="c"># 생성된 pod 확인</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl get pods <span class="nt">--all-namespaces</span>
NAMESPACE              NAME                                        READY   STATUS    RESTARTS   AGE
kube-system            calico-node-wvxxm                           2/2     Running   0          11d
kube-system            calico-node-zxkxk                           2/2     Running   2          11d
kube-system            coredns-5c98db65d4-97gng                    1/1     Running   0          11d
kube-system            coredns-5c98db65d4-fvz2k                    1/1     Running   0          11d
kube-system            etcd-k8smaster1                             1/1     Running   0          11d
kube-system            kube-apiserver-k8smaster1                   1/1     Running   0          11d
kube-system            kube-controller-manager-k8smaster1          1/1     Running   0          11d
kube-system            kube-proxy-t62q4                            1/1     Running   0          11d
kube-system            kube-proxy-tnmtr                            1/1     Running   1          11d
kube-system            kube-scheduler-k8smaster1                   1/1     Running   0          11d
kube-system            metrics-server-86cd7c944f-99qsx             1/1     Running   0          3d7h
kube-system            tiller-deploy-54f7455d59-kfq5d              0/1     Running   0          9s
kube-system            traefik-ingress-controller-8884w            1/1     Running   0          3d13h
kube-system            traefik-ingress-controller-jdvck            1/1     Running   0          4d6h
kubernetes-dashboard   dashboard-metrics-scraper-fb986f88d-wrsv9   1/1     Running   0          2d13h
kubernetes-dashboard   kubernetes-dashboard-6bb65fcc49-wvw2z       1/1     Running   0          2d13h

<span class="c"># tiller 로그 확인</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> kube-system logs tiller-deploy-54f7455d59-kfq5d
<span class="o">[</span>main] 2020/02/08 15:17:07 Starting Tiller v2.16.1 <span class="o">(</span><span class="nv">tls</span><span class="o">=</span><span class="nb">false</span><span class="o">)</span>
<span class="o">[</span>main] 2020/02/08 15:17:07 GRPC listening on :44134
<span class="o">[</span>main] 2020/02/08 15:17:07 Probes listening on :44135
<span class="o">[</span>main] 2020/02/08 15:17:07 Storage driver is ConfigMap
<span class="o">[</span>main] 2020/02/08 15:17:07 Max <span class="nb">history </span>per release is 0

<span class="c"># helm 도움말</span>
ps0107@k8smaster1:~<span class="nv">$ </span>helm <span class="nb">help
</span>The Kubernetes package manager

To begin working with Helm, run the <span class="s1">'helm init'</span> <span class="nb">command</span>:

	<span class="nv">$ </span>helm init

This will <span class="nb">install </span>Tiller to your running Kubernetes cluster.
It will also <span class="nb">set </span>up any necessary <span class="nb">local </span>configuration.

Common actions from this point include:

- helm search:    Search <span class="k">for </span>charts
- helm fetch:     Download a chart to your <span class="nb">local </span>directory to view
- helm <span class="nb">install</span>:   Upload the chart to Kubernetes
- helm list:      List releases of charts

Environment:

- <span class="nv">$HELM_HOME</span>:           Set an alternative location <span class="k">for </span>Helm files. By default, these are stored <span class="k">in</span> ~/.helm
- <span class="nv">$HELM_HOST</span>:           Set an alternative Tiller host. The format is host:port
- <span class="nv">$HELM_NO_PLUGINS</span>:     Disable plugins. Set <span class="nv">HELM_NO_PLUGINS</span><span class="o">=</span>1 to disable plugins.
- <span class="nv">$TILLER_NAMESPACE</span>:    Set an alternative Tiller namespace <span class="o">(</span>default <span class="s2">"kube-system"</span><span class="o">)</span>
- <span class="nv">$KUBECONFIG</span>:          Set an alternative Kubernetes configuration file <span class="o">(</span>default <span class="s2">"~/.kube/config"</span><span class="o">)</span>
- <span class="nv">$HELM_TLS_CA_CERT</span>:    Path to TLS CA certificate used to verify the Helm client and Tiller server certificates <span class="o">(</span>default <span class="s2">"</span><span class="nv">$HELM_HOME</span><span class="s2">/ca.pem"</span><span class="o">)</span>
- <span class="nv">$HELM_TLS_CERT</span>:       Path to TLS client certificate file <span class="k">for </span>authenticating to Tiller <span class="o">(</span>default <span class="s2">"</span><span class="nv">$HELM_HOME</span><span class="s2">/cert.pem"</span><span class="o">)</span>
- <span class="nv">$HELM_TLS_KEY</span>:        Path to TLS client key file <span class="k">for </span>authenticating to Tiller <span class="o">(</span>default <span class="s2">"</span><span class="nv">$HELM_HOME</span><span class="s2">/key.pem"</span><span class="o">)</span>
- <span class="nv">$HELM_TLS_ENABLE</span>:     Enable TLS connection between Helm and Tiller <span class="o">(</span>default <span class="s2">"false"</span><span class="o">)</span>
- <span class="nv">$HELM_TLS_VERIFY</span>:     Enable TLS connection between Helm and Tiller and verify Tiller server certificate <span class="o">(</span>default <span class="s2">"false"</span><span class="o">)</span>
- <span class="nv">$HELM_TLS_HOSTNAME</span>:   The <span class="nb">hostname </span>or IP address used to verify the Tiller server certificate <span class="o">(</span>default <span class="s2">"127.0.0.1"</span><span class="o">)</span>
- <span class="nv">$HELM_KEY_PASSPHRASE</span>: Set HELM_KEY_PASSPHRASE to the passphrase of your PGP private key. If <span class="nb">set</span>, you will not be prompted <span class="k">for </span>the passphrase <span class="k">while </span>signing helm charts

Usage:
  helm <span class="o">[</span><span class="nb">command</span><span class="o">]</span>

Available Commands:
  completion  Generate autocompletions script <span class="k">for </span>the specified shell <span class="o">(</span>bash or zsh<span class="o">)</span>
  create      Create a new chart with the given name
  delete      Given a release name, delete the release from Kubernetes
  dependency  Manage a chart is dependencies
  fetch       Download a chart from a repository and <span class="o">(</span>optionally<span class="o">)</span> unpack it <span class="k">in </span><span class="nb">local </span>directory
  get         Download a named release
  <span class="nb">help        </span>Help about any <span class="nb">command
  history     </span>Fetch release <span class="nb">history
  </span>home        Displays the location of HELM_HOME
  init        Initialize Helm on both client and server
  inspect     Inspect a chart
  <span class="nb">install     </span>Install a chart archive
  lint        Examines a chart <span class="k">for </span>possible issues
  list        List releases
  package     Package a chart directory into a chart archive
  plugin      Add, list, or remove Helm plugins
  repo        Add, list, remove, update, and index chart repositories
  reset       Uninstalls Tiller from a cluster
  rollback    Rollback a release to a previous revision
  search      Search <span class="k">for </span>a keyword <span class="k">in </span>charts
  serve       Start a <span class="nb">local </span>http web server
  status      Displays the status of the named release
  template    Locally render templates
  <span class="nb">test        </span>Test a release
  upgrade     Upgrade a release
  verify      Verify that a chart at the given path has been signed and is valid
  version     Print the client/server version information

Flags:
      <span class="nt">--debug</span>                           Enable verbose output
  <span class="nt">-h</span>, <span class="nt">--help</span>                            <span class="nb">help </span><span class="k">for </span>helm
      <span class="nt">--home</span> string                     Location of your Helm config. Overrides <span class="nv">$HELM_HOME</span> <span class="o">(</span>default <span class="s2">"/home/ps0107/.helm"</span><span class="o">)</span>
      <span class="nt">--host</span> string                     Address of Tiller. Overrides <span class="nv">$HELM_HOST</span>
      <span class="nt">--kube-context</span> string             Name of the kubeconfig context to use
      <span class="nt">--kubeconfig</span> string               Absolute path of the kubeconfig file to be used
      <span class="nt">--tiller-connection-timeout</span> int   The duration <span class="o">(</span><span class="k">in </span>seconds<span class="o">)</span> Helm will <span class="nb">wait </span>to establish a connection to Tiller <span class="o">(</span>default 300<span class="o">)</span>
      <span class="nt">--tiller-namespace</span> string         Namespace of Tiller <span class="o">(</span>default <span class="s2">"kube-system"</span><span class="o">)</span>

Use <span class="s2">"helm [command] --help"</span> <span class="k">for </span>more information about a command.

<span class="c"># helm home</span>
ps0107@k8smaster1:~<span class="nv">$ </span>helm home
/home/ps0107/.helm

<span class="c"># helm homedirectory 확인</span>
ps0107@k8smaster1:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-R</span> /home/ps0107/.helm
/home/ps0107/.helm:
cache  plugins  repository  starters

/home/ps0107/.helm/cache:
archive

/home/ps0107/.helm/cache/archive:

/home/ps0107/.helm/plugins:

/home/ps0107/.helm/repository:
cache  <span class="nb">local  </span>repositories.yaml

/home/ps0107/.helm/repository/cache:
local-index.yaml  stable-index.yaml

/home/ps0107/.helm/repository/local:
index.yaml

/home/ps0107/.helm/starters:

<span class="c"># helm 버전 확인</span>
ps0107@k8smaster1:~<span class="nv">$ </span>helm version
Client: &amp;version.Version<span class="o">{</span>SemVer:<span class="s2">"v2.16.1"</span>, GitCommit:<span class="s2">"bbdfe5e7803a12bbdf97e94cd847859890cf4050"</span>, GitTreeState:<span class="s2">"clean"</span><span class="o">}</span>
Server: &amp;version.Version<span class="o">{</span>SemVer:<span class="s2">"v2.16.1"</span>, GitCommit:<span class="s2">"bbdfe5e7803a12bbdf97e94cd847859890cf4050"</span>, GitTreeState:<span class="s2">"clean"</span><span class="o">}</span>
</pre></table></code></div></div><h2 id="helm을-이용한-mariadb-배포">helm을 이용한 mariadb 배포</h2><ul><li>mariadb 디버그 모드로 인스톨 해본다.</ul><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734
735
</pre><td class="rouge-code"><pre><span class="c"># -------------------------------------------------</span>
<span class="c"># helm을 이용한 mariadb 배포</span>
<span class="c"># ---------------------------------------------------</span>
<span class="c"># helm search 를 통해 리스트를 확인해 볼수 있다. database에 대한 리스트가 많이 나오는군요...</span>
ps0107@k8smaster1:~<span class="nv">$ </span>helm search database
NAME                         	CHART VERSION	APP VERSION            	DESCRIPTION
stable/cockroachdb           	3.0.4        	19.2.3                 	CockroachDB is a scalable, survivable, strongly-consisten...
stable/couchdb               	2.3.0        	2.3.1                  	DEPRECATED A database featuring seamless multi-master syn...
stable/dokuwiki              	6.0.6        	0.20180422.201901061035	DokuWiki is a standards-compliant, simple to use wiki opt...
stable/ignite                	1.0.1        	2.7.6                  	Apache Ignite is an open-source distributed database, cac...
stable/janusgraph            	0.2.1        	1.0                    	Open <span class="nb">source</span>, scalable graph database.
stable/kubedb                	0.1.3        	0.8.0-beta.2           	DEPRECATED KubeDB by AppsCode - Making running production...
stable/mariadb               	7.3.7        	10.3.22                	Fast, reliable, scalable, and easy to use open-source rel...
.......

<span class="c"># mariadb 인스톨 (debug 모드)</span>
ps0107@k8smaster1:~<span class="nv">$ </span>helm <span class="nt">--debug</span> <span class="nb">install </span>stable/mariadb <span class="nt">--set</span> master.persistence.enabled<span class="o">=</span><span class="nb">false</span> <span class="nt">--set</span> slave.persistence.enabled<span class="o">=</span><span class="nb">false</span>|tee helm.out
<span class="o">[</span>debug] Created tunnel using <span class="nb">local </span>port: <span class="s1">'34569'</span>

<span class="o">[</span>debug] SERVER: <span class="s2">"127.0.0.1:34569"</span>

<span class="o">[</span>debug] Original chart version: <span class="s2">""</span>
<span class="o">[</span>debug] Fetched stable/mariadb to /home/ps0107/.helm/cache/archive/mariadb-7.3.7.tgz

<span class="o">[</span>debug] CHART PATH: /home/ps0107/.helm/cache/archive/mariadb-7.3.7.tgz

NAME:   right-termite  <span class="c"># &lt;-- 기억해두기</span>
REVISION: 1
RELEASED: Sat Feb  8 15:47:33 2020
CHART: mariadb-7.3.7
USER-SUPPLIED VALUES:
master:
  persistence:
    enabled: <span class="nb">false
</span>slave:
  persistence:
    enabled: <span class="nb">false

</span>COMPUTED VALUES:
db:
  forcePassword: <span class="nb">false
  </span>injectSecretsAsVolume: <span class="nb">false
  </span>name: my_database
  password: <span class="s2">""</span>
  user: <span class="s2">""</span>
image:
  debug: <span class="nb">false
  </span>pullPolicy: IfNotPresent
  registry: docker.io
  repository: bitnami/mariadb
  tag: 10.3.22-debian-10-r0
master:
  affinity: <span class="o">{}</span>
  antiAffinity: soft
  config: |-
    <span class="o">[</span>mysqld]
    skip-name-resolve
    explicit_defaults_for_timestamp
    <span class="nv">basedir</span><span class="o">=</span>/opt/bitnami/mariadb
    <span class="nv">plugin_dir</span><span class="o">=</span>/opt/bitnami/mariadb/plugin
    <span class="nv">port</span><span class="o">=</span>3306
    <span class="nv">socket</span><span class="o">=</span>/opt/bitnami/mariadb/tmp/mysql.sock
    <span class="nv">tmpdir</span><span class="o">=</span>/opt/bitnami/mariadb/tmp
    <span class="nv">max_allowed_packet</span><span class="o">=</span>16M
    bind-address<span class="o">=</span>0.0.0.0
    pid-file<span class="o">=</span>/opt/bitnami/mariadb/tmp/mysqld.pid
    log-error<span class="o">=</span>/opt/bitnami/mariadb/logs/mysqld.log
    character-set-server<span class="o">=</span>UTF8
    collation-server<span class="o">=</span>utf8_general_ci

    <span class="o">[</span>client]
    <span class="nv">port</span><span class="o">=</span>3306
    <span class="nv">socket</span><span class="o">=</span>/opt/bitnami/mariadb/tmp/mysql.sock
    default-character-set<span class="o">=</span>UTF8
    <span class="nv">plugin_dir</span><span class="o">=</span>/opt/bitnami/mariadb/plugin

    <span class="o">[</span>manager]
    <span class="nv">port</span><span class="o">=</span>3306
    <span class="nv">socket</span><span class="o">=</span>/opt/bitnami/mariadb/tmp/mysql.sock
    pid-file<span class="o">=</span>/opt/bitnami/mariadb/tmp/mysqld.pid
  extraInitContainers: <span class="s2">""</span>
  livenessProbe:
    enabled: <span class="nb">true
    </span>failureThreshold: 3
    initialDelaySeconds: 120
    periodSeconds: 10
    successThreshold: 1
    timeoutSeconds: 1
  nodeSelector: <span class="o">{}</span>
  persistence:
    accessModes:
    - ReadWriteOnce
    annotations: <span class="o">{}</span>
    enabled: <span class="nb">false
    </span>mountPath: /bitnami/mariadb
    size: 8Gi
  podDisruptionBudget:
    enabled: <span class="nb">false
    </span>minAvailable: 1
  readinessProbe:
    enabled: <span class="nb">true
    </span>failureThreshold: 3
    initialDelaySeconds: 30
    periodSeconds: 10
    successThreshold: 1
    timeoutSeconds: 1
  resources: <span class="o">{}</span>
  service:
    annotations: <span class="o">{}</span>
  tolerations: <span class="o">[]</span>
  updateStrategy:
    <span class="nb">type</span>: RollingUpdate
metrics:
  annotations:
    prometheus.io/port: <span class="s2">"9104"</span>
    prometheus.io/scrape: <span class="s2">"true"</span>
  enabled: <span class="nb">false
  </span>extraArgs:
    master: <span class="o">[]</span>
    slave: <span class="o">[]</span>
  image:
    pullPolicy: IfNotPresent
    registry: docker.io
    repository: bitnami/mysqld-exporter
    tag: 0.12.1-debian-10-r4
  livenessProbe:
    enabled: <span class="nb">true
    </span>failureThreshold: 3
    initialDelaySeconds: 120
    periodSeconds: 10
    successThreshold: 1
    timeoutSeconds: 1
  readinessProbe:
    enabled: <span class="nb">true
    </span>failureThreshold: 3
    initialDelaySeconds: 30
    periodSeconds: 10
    successThreshold: 1
    timeoutSeconds: 1
  resources: <span class="o">{}</span>
  serviceMonitor:
    enabled: <span class="nb">false
    </span>selector:
      prometheus: kube-prometheus
rbac:
  create: <span class="nb">false
</span>replication:
  enabled: <span class="nb">true
  </span>forcePassword: <span class="nb">false
  </span>injectSecretsAsVolume: <span class="nb">false
  </span>password: <span class="s2">""</span>
  user: replicator
rootUser:
  forcePassword: <span class="nb">false
  </span>injectSecretsAsVolume: <span class="nb">false
  </span>password: <span class="s2">""</span>
securityContext:
  enabled: <span class="nb">true
  </span>fsGroup: 1001
  runAsUser: 1001
service:
  port: 3306
  <span class="nb">type</span>: ClusterIP
serviceAccount:
  create: <span class="nb">false
</span>slave:
  affinity: <span class="o">{}</span>
  antiAffinity: soft
  config: |-
    <span class="o">[</span>mysqld]
    skip-name-resolve
    explicit_defaults_for_timestamp
    <span class="nv">basedir</span><span class="o">=</span>/opt/bitnami/mariadb
    <span class="nv">port</span><span class="o">=</span>3306
    <span class="nv">socket</span><span class="o">=</span>/opt/bitnami/mariadb/tmp/mysql.sock
    <span class="nv">tmpdir</span><span class="o">=</span>/opt/bitnami/mariadb/tmp
    <span class="nv">max_allowed_packet</span><span class="o">=</span>16M
    bind-address<span class="o">=</span>0.0.0.0
    pid-file<span class="o">=</span>/opt/bitnami/mariadb/tmp/mysqld.pid
    log-error<span class="o">=</span>/opt/bitnami/mariadb/logs/mysqld.log
    character-set-server<span class="o">=</span>UTF8
    collation-server<span class="o">=</span>utf8_general_ci

    <span class="o">[</span>client]
    <span class="nv">port</span><span class="o">=</span>3306
    <span class="nv">socket</span><span class="o">=</span>/opt/bitnami/mariadb/tmp/mysql.sock
    default-character-set<span class="o">=</span>UTF8

    <span class="o">[</span>manager]
    <span class="nv">port</span><span class="o">=</span>3306
    <span class="nv">socket</span><span class="o">=</span>/opt/bitnami/mariadb/tmp/mysql.sock
    pid-file<span class="o">=</span>/opt/bitnami/mariadb/tmp/mysqld.pid
  extraInitContainers: <span class="s2">""</span>
  livenessProbe:
    enabled: <span class="nb">true
    </span>failureThreshold: 3
    initialDelaySeconds: 120
    periodSeconds: 10
    successThreshold: 1
    timeoutSeconds: 1
  nodeSelector: <span class="o">{}</span>
  persistence:
    accessModes:
    - ReadWriteOnce
    annotations: null
    enabled: <span class="nb">false
    </span>size: 8Gi
  podDisruptionBudget:
    enabled: <span class="nb">false
    </span>minAvailable: 1
  readinessProbe:
    enabled: <span class="nb">true
    </span>failureThreshold: 3
    initialDelaySeconds: 45
    periodSeconds: 10
    successThreshold: 1
    timeoutSeconds: 1
  replicas: 1
  resources: <span class="o">{}</span>
  service:
    annotations: <span class="o">{}</span>
  tolerations: <span class="o">[]</span>
  updateStrategy:
    <span class="nb">type</span>: RollingUpdate
tests:
  enabled: <span class="nb">true
  </span>testFramework:
    image:
      registry: docker.io
      repository: dduportal/bats
      tag: 0.4.0
volumePermissions:
  enabled: <span class="nb">false
  </span>image:
    pullPolicy: Always
    registry: docker.io
    repository: bitnami/minideb
    tag: stretch
  resources: <span class="o">{}</span>

HOOKS:
<span class="nt">---</span>
<span class="c"># right-termite-mariadb-test-3tk9w</span>
apiVersion: v1
kind: Pod
metadata:
  name: <span class="s2">"right-termite-mariadb-test-3tk9w"</span>
  annotations:
    <span class="s2">"helm.sh/hook"</span>: test-success
spec:
  initContainers:
    - name: <span class="s2">"test-framework"</span>
      image: docker.io/dduportal/bats:0.4.0
      <span class="nb">command</span>:
        - <span class="s2">"bash"</span>
        - <span class="s2">"-c"</span>
        - |
          <span class="nb">set</span> <span class="nt">-ex</span>
          <span class="c"># copy bats to tools dir</span>
          <span class="nb">cp</span> <span class="nt">-R</span> /usr/local/libexec/ /tools/bats/
      volumeMounts:
      - mountPath: /tools
        name: tools
  containers:
    - name: mariadb-test
      image: docker.io/bitnami/mariadb:10.3.22-debian-10-r0
      imagePullPolicy: <span class="s2">"IfNotPresent"</span>
      <span class="nb">command</span>: <span class="o">[</span><span class="s2">"/tools/bats/bats"</span>, <span class="s2">"-t"</span>, <span class="s2">"/tests/run.sh"</span><span class="o">]</span>
      <span class="nb">env</span>:
        - name: MARIADB_ROOT_PASSWORD
          valueFrom:
            secretKeyRef:
              name: right-termite-mariadb
              key: mariadb-root-password
      volumeMounts:
      - mountPath: /tests
        name: tests
        readOnly: <span class="nb">true</span>
      - mountPath: /tools
        name: tools
  volumes:
  - name: tests
    configMap:
      name: right-termite-mariadb-tests
  - name: tools
    emptyDir: <span class="o">{}</span>
  restartPolicy: Never
MANIFEST:

<span class="nt">---</span>
<span class="c"># Source: mariadb/templates/secrets.yaml</span>
apiVersion: v1
kind: Secret
metadata:
  name: right-termite-mariadb
  labels:
    app: <span class="s2">"mariadb"</span>
    chart: <span class="s2">"mariadb-7.3.7"</span>
    release: <span class="s2">"right-termite"</span>
    heritage: <span class="s2">"Tiller"</span>
<span class="nb">type</span>: Opaque
data:
  mariadb-root-password: <span class="s2">"eDJTd01NWm93OA=="</span>

  mariadb-replication-password: <span class="s2">"Qm50UEp0elI3dw=="</span>
<span class="nt">---</span>
<span class="c"># Source: mariadb/templates/master-configmap.yaml</span>
apiVersion: v1
kind: ConfigMap
metadata:
  name: right-termite-mariadb-master
  labels:
    app: <span class="s2">"mariadb"</span>
    component: <span class="s2">"master"</span>
    chart: <span class="s2">"mariadb-7.3.7"</span>
    release: <span class="s2">"right-termite"</span>
    heritage: <span class="s2">"Tiller"</span>
data:
  my.cnf: |-
    <span class="o">[</span>mysqld]
    skip-name-resolve
    explicit_defaults_for_timestamp
    <span class="nv">basedir</span><span class="o">=</span>/opt/bitnami/mariadb
    <span class="nv">plugin_dir</span><span class="o">=</span>/opt/bitnami/mariadb/plugin
    <span class="nv">port</span><span class="o">=</span>3306
    <span class="nv">socket</span><span class="o">=</span>/opt/bitnami/mariadb/tmp/mysql.sock
    <span class="nv">tmpdir</span><span class="o">=</span>/opt/bitnami/mariadb/tmp
    <span class="nv">max_allowed_packet</span><span class="o">=</span>16M
    bind-address<span class="o">=</span>0.0.0.0
    pid-file<span class="o">=</span>/opt/bitnami/mariadb/tmp/mysqld.pid
    log-error<span class="o">=</span>/opt/bitnami/mariadb/logs/mysqld.log
    character-set-server<span class="o">=</span>UTF8
    collation-server<span class="o">=</span>utf8_general_ci

    <span class="o">[</span>client]
    <span class="nv">port</span><span class="o">=</span>3306
    <span class="nv">socket</span><span class="o">=</span>/opt/bitnami/mariadb/tmp/mysql.sock
    default-character-set<span class="o">=</span>UTF8
    <span class="nv">plugin_dir</span><span class="o">=</span>/opt/bitnami/mariadb/plugin

    <span class="o">[</span>manager]
    <span class="nv">port</span><span class="o">=</span>3306
    <span class="nv">socket</span><span class="o">=</span>/opt/bitnami/mariadb/tmp/mysql.sock
    pid-file<span class="o">=</span>/opt/bitnami/mariadb/tmp/mysqld.pid
<span class="nt">---</span>
<span class="c"># Source: mariadb/templates/slave-configmap.yaml</span>
apiVersion: v1
kind: ConfigMap
metadata:
  name: right-termite-mariadb-slave
  labels:
    app: <span class="s2">"mariadb"</span>
    component: <span class="s2">"slave"</span>
    chart: <span class="s2">"mariadb-7.3.7"</span>
    release: <span class="s2">"right-termite"</span>
    heritage: <span class="s2">"Tiller"</span>
data:
  my.cnf: |-
    <span class="o">[</span>mysqld]
    skip-name-resolve
    explicit_defaults_for_timestamp
    <span class="nv">basedir</span><span class="o">=</span>/opt/bitnami/mariadb
    <span class="nv">port</span><span class="o">=</span>3306
    <span class="nv">socket</span><span class="o">=</span>/opt/bitnami/mariadb/tmp/mysql.sock
    <span class="nv">tmpdir</span><span class="o">=</span>/opt/bitnami/mariadb/tmp
    <span class="nv">max_allowed_packet</span><span class="o">=</span>16M
    bind-address<span class="o">=</span>0.0.0.0
    pid-file<span class="o">=</span>/opt/bitnami/mariadb/tmp/mysqld.pid
    log-error<span class="o">=</span>/opt/bitnami/mariadb/logs/mysqld.log
    character-set-server<span class="o">=</span>UTF8
    collation-server<span class="o">=</span>utf8_general_ci

    <span class="o">[</span>client]
    <span class="nv">port</span><span class="o">=</span>3306
    <span class="nv">socket</span><span class="o">=</span>/opt/bitnami/mariadb/tmp/mysql.sock
    default-character-set<span class="o">=</span>UTF8

    <span class="o">[</span>manager]
    <span class="nv">port</span><span class="o">=</span>3306
    <span class="nv">socket</span><span class="o">=</span>/opt/bitnami/mariadb/tmp/mysql.sock
    pid-file<span class="o">=</span>/opt/bitnami/mariadb/tmp/mysqld.pid
<span class="nt">---</span>
<span class="c"># Source: mariadb/templates/tests.yaml</span>
apiVersion: v1
kind: ConfigMap
metadata:
  name: right-termite-mariadb-tests
data:
  run.sh: |-
    @test <span class="s2">"Testing MariaDB is accessible"</span> <span class="o">{</span>
      mysql <span class="nt">-h</span> right-termite-mariadb <span class="nt">-uroot</span> <span class="nt">-p</span><span class="nv">$MARIADB_ROOT_PASSWORD</span> <span class="nt">-e</span> <span class="s1">'show databases;'</span>
    <span class="o">}</span>
<span class="nt">---</span>
<span class="c"># Source: mariadb/templates/master-svc.yaml</span>
apiVersion: v1
kind: Service
metadata:
  name: right-termite-mariadb
  labels:
    app: <span class="s2">"mariadb"</span>
    component: <span class="s2">"master"</span>
    chart: <span class="s2">"mariadb-7.3.7"</span>
    release: <span class="s2">"right-termite"</span>
    heritage: <span class="s2">"Tiller"</span>
spec:
  <span class="nb">type</span>: ClusterIP
  ports:
  - name: mysql
    port: 3306
    targetPort: mysql
  selector:
    app: <span class="s2">"mariadb"</span>
    component: <span class="s2">"master"</span>
    release: <span class="s2">"right-termite"</span>
<span class="nt">---</span>
<span class="c"># Source: mariadb/templates/slave-svc.yaml</span>
apiVersion: v1
kind: Service
metadata:
  name: right-termite-mariadb-slave
  labels:
    app: <span class="s2">"mariadb"</span>
    chart: <span class="s2">"mariadb-7.3.7"</span>
    component: <span class="s2">"slave"</span>
    release: <span class="s2">"right-termite"</span>
    heritage: <span class="s2">"Tiller"</span>
spec:
  <span class="nb">type</span>: ClusterIP
  ports:
  - name: mysql
    port: 3306
    targetPort: mysql
  selector:
    app: <span class="s2">"mariadb"</span>
    component: <span class="s2">"slave"</span>
    release: <span class="s2">"right-termite"</span>
<span class="nt">---</span>
<span class="c"># Source: mariadb/templates/master-statefulset.yaml</span>
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: right-termite-mariadb-master
  labels:
    app: mariadb
    chart: mariadb-7.3.7
    release: right-termite
    heritage: Tiller
    component: master
spec:
  selector:
    matchLabels:
      app: mariadb
      release: right-termite
      component: master
  serviceName: right-termite-mariadb-master
  replicas: 1
  updateStrategy:
    <span class="nb">type</span>: RollingUpdate
  template:
    metadata:
      labels:
        app: mariadb
        chart: mariadb-7.3.7
        release: right-termite
        component: master
    spec:
      serviceAccountName: default
      securityContext:
        fsGroup: 1001
        runAsUser: 1001
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - weight: 1
              podAffinityTerm:
                topologyKey: kubernetes.io/hostname
                labelSelector:
                  matchLabels:
                    app: mariadb
                    release: right-termite
      initContainers:
      containers:
        - name: <span class="s2">"mariadb"</span>
          image: docker.io/bitnami/mariadb:10.3.22-debian-10-r0
          imagePullPolicy: <span class="s2">"IfNotPresent"</span>
          <span class="nb">env</span>:
            - name: MARIADB_ROOT_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: right-termite-mariadb
                  key: mariadb-root-password
            - name: MARIADB_DATABASE
              value: <span class="s2">"my_database"</span>
            - name: MARIADB_REPLICATION_MODE
              value: <span class="s2">"master"</span>
            - name: MARIADB_REPLICATION_USER
              value: <span class="s2">"replicator"</span>
            - name: MARIADB_REPLICATION_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: right-termite-mariadb
                  key: mariadb-replication-password
          ports:
            - name: mysql
              containerPort: 3306
          livenessProbe:
            <span class="nb">exec</span>:
              <span class="nb">command</span>:
                - sh
                - <span class="nt">-c</span>
                - |
                  <span class="nv">password_aux</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">MARIADB_ROOT_PASSWORD</span><span class="k">:-}</span><span class="s2">"</span>
                  <span class="k">if</span> <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="k">${</span><span class="nv">MARIADB_ROOT_PASSWORD_FILE</span><span class="k">:-}</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
                      </span><span class="nv">password_aux</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat</span> <span class="nv">$MARIADB_ROOT_PASSWORD_FILE</span><span class="si">)</span>
                  <span class="k">fi
                  </span>mysqladmin status <span class="nt">-uroot</span> <span class="nt">-p</span><span class="nv">$password_aux</span>
            initialDelaySeconds: 120
            periodSeconds: 10
            timeoutSeconds: 1
            successThreshold: 1
            failureThreshold: 3
          readinessProbe:
            <span class="nb">exec</span>:
              <span class="nb">command</span>:
                - sh
                - <span class="nt">-c</span>
                - |
                  <span class="nv">password_aux</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">MARIADB_ROOT_PASSWORD</span><span class="k">:-}</span><span class="s2">"</span>
                  <span class="k">if</span> <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="k">${</span><span class="nv">MARIADB_ROOT_PASSWORD_FILE</span><span class="k">:-}</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
                      </span><span class="nv">password_aux</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat</span> <span class="nv">$MARIADB_ROOT_PASSWORD_FILE</span><span class="si">)</span>
                  <span class="k">fi
                  </span>mysqladmin status <span class="nt">-uroot</span> <span class="nt">-p</span><span class="nv">$password_aux</span>
            initialDelaySeconds: 30
            periodSeconds: 10
            timeoutSeconds: 1
            successThreshold: 1
            failureThreshold: 3
          volumeMounts:
            - name: data
              mountPath: /bitnami/mariadb
            - name: config
              mountPath: /opt/bitnami/mariadb/conf/my.cnf
              subPath: my.cnf
      volumes:
        - name: config
          configMap:
            name: right-termite-mariadb-master
        - name: data
          emptyDir: <span class="o">{}</span>
<span class="nt">---</span>
<span class="c"># Source: mariadb/templates/slave-statefulset.yaml</span>
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: right-termite-mariadb-slave
  labels:
    app: mariadb
    chart: mariadb-7.3.7
    release: right-termite
    heritage: Tiller
    component: slave
spec:
  selector:
    matchLabels:
      app: mariadb
      release: right-termite
      component: slave
  serviceName: right-termite-mariadb-slave
  replicas: 1
  updateStrategy:
    <span class="nb">type</span>: RollingUpdate
  template:
    metadata:
      labels:
        app: mariadb
        chart: mariadb-7.3.7
        release: right-termite
        component: slave
    spec:
      serviceAccountName: default
      securityContext:
        fsGroup: 1001
        runAsUser: 1001
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - weight: 1
              podAffinityTerm:
                topologyKey: kubernetes.io/hostname
                labelSelector:
                  matchLabels:
                    app: mariadb
                    release: right-termite
      initContainers:
      containers:
        - name: <span class="s2">"mariadb"</span>
          image: docker.io/bitnami/mariadb:10.3.22-debian-10-r0
          imagePullPolicy: <span class="s2">"IfNotPresent"</span>
          <span class="nb">env</span>:
            - name: MARIADB_REPLICATION_MODE
              value: <span class="s2">"slave"</span>
            - name: MARIADB_MASTER_HOST
              value: right-termite-mariadb
            - name: MARIADB_MASTER_PORT_NUMBER
              value: <span class="s2">"3306"</span>
            - name: MARIADB_MASTER_ROOT_USER
              value: <span class="s2">"root"</span>
            - name: MARIADB_MASTER_ROOT_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: right-termite-mariadb
                  key: mariadb-root-password
            - name: MARIADB_REPLICATION_USER
              value: <span class="s2">"replicator"</span>
            - name: MARIADB_REPLICATION_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: right-termite-mariadb
                  key: mariadb-replication-password
          ports:
            - name: mysql
              containerPort: 3306
          livenessProbe:
            <span class="nb">exec</span>:
              <span class="nb">command</span>:
                - sh
                - <span class="nt">-c</span>
                - |
                  <span class="nv">password_aux</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">MARIADB_MASTER_ROOT_PASSWORD</span><span class="k">:-}</span><span class="s2">"</span>
                  <span class="k">if</span> <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="k">${</span><span class="nv">MARIADB_MASTER_ROOT_PASSWORD_FILE</span><span class="k">:-}</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
                      </span><span class="nv">password_aux</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat</span> <span class="nv">$MARIADB_MASTER_ROOT_PASSWORD_FILE</span><span class="si">)</span>
                  <span class="k">fi
                  </span>mysqladmin status <span class="nt">-uroot</span> <span class="nt">-p</span><span class="nv">$password_aux</span>
            initialDelaySeconds: 120
            periodSeconds: 10
            timeoutSeconds: 1
            successThreshold: 1
            failureThreshold: 3
          readinessProbe:
            <span class="nb">exec</span>:
              <span class="nb">command</span>:
                - sh
                - <span class="nt">-c</span>
                - |
                  <span class="nv">password_aux</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">MARIADB_MASTER_ROOT_PASSWORD</span><span class="k">:-}</span><span class="s2">"</span>
                  <span class="k">if</span> <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="k">${</span><span class="nv">MARIADB_MASTER_ROOT_PASSWORD_FILE</span><span class="k">:-}</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
                      </span><span class="nv">password_aux</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat</span> <span class="nv">$MARIADB_MASTER_ROOT_PASSWORD_FILE</span><span class="si">)</span>
                  <span class="k">fi
                  </span>mysqladmin status <span class="nt">-uroot</span> <span class="nt">-p</span><span class="nv">$password_aux</span>
            initialDelaySeconds: 45
            periodSeconds: 10
            timeoutSeconds: 1
            successThreshold: 1
            failureThreshold: 3
          volumeMounts:
            - name: data
              mountPath: /bitnami/mariadb
            - name: config
              mountPath: /opt/bitnami/mariadb/conf/my.cnf
              subPath: my.cnf
      volumes:
        - name: config
          configMap:
            name: right-termite-mariadb-slave
        - name: <span class="s2">"data"</span>
          emptyDir: <span class="o">{}</span>
LAST DEPLOYED: Sat Feb  8 15:47:33 2020
NAMESPACE: default
STATUS: DEPLOYED

RESOURCES:
<span class="o">==&gt;</span> v1/ConfigMap
NAME                          AGE
right-termite-mariadb-master  0s
right-termite-mariadb-slave   0s
right-termite-mariadb-tests   0s

<span class="o">==&gt;</span> v1/Pod<span class="o">(</span>related<span class="o">)</span>
NAME                            AGE
right-termite-mariadb-master-0  0s
right-termite-mariadb-slave-0   0s

<span class="o">==&gt;</span> v1/Secret
NAME                   AGE
right-termite-mariadb  0s

<span class="o">==&gt;</span> v1/Service
NAME                         AGE
right-termite-mariadb        0s
right-termite-mariadb-slave  0s

<span class="o">==&gt;</span> v1/StatefulSet
NAME                          AGE
right-termite-mariadb-master  0s
right-termite-mariadb-slave   0s


NOTES:

Please be patient <span class="k">while </span>the chart is being deployed

Tip:

  Watch the deployment status using the <span class="nb">command</span>: kubectl get pods <span class="nt">-w</span> <span class="nt">--namespace</span> default <span class="nt">-l</span> <span class="nv">release</span><span class="o">=</span>right-termite

Services:

  <span class="nb">echo </span>Master: right-termite-mariadb.default.svc.cluster.local:3306
  <span class="nb">echo </span>Slave:  right-termite-mariadb-slave.default.svc.cluster.local:3306

Administrator credentials:

  Username: root
  Password : <span class="si">$(</span>kubectl get secret <span class="nt">--namespace</span> default right-termite-mariadb <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">"{.data.mariadb-root-password}"</span> | <span class="nb">base64</span> <span class="nt">--decode</span><span class="si">)</span>

To connect to your database:

  1. Run a pod that you can use as a client:

      kubectl run right-termite-mariadb-client <span class="nt">--rm</span> <span class="nt">--tty</span> <span class="nt">-i</span> <span class="nt">--restart</span><span class="o">=</span><span class="s1">'Never'</span> <span class="nt">--image</span>  docker.io/bitnami/mariadb:10.3.22-debian-10-r0 <span class="nt">--namespace</span> default <span class="nt">--command</span> <span class="nt">--</span> bash

  2. To connect to master service <span class="o">(</span><span class="nb">read</span>/write<span class="o">)</span>:

      mysql <span class="nt">-h</span> right-termite-mariadb.default.svc.cluster.local <span class="nt">-uroot</span> <span class="nt">-p</span> my_database

  3. To connect to slave service <span class="o">(</span>read-only<span class="o">)</span>:

      mysql <span class="nt">-h</span> right-termite-mariadb-slave.default.svc.cluster.local <span class="nt">-uroot</span> <span class="nt">-p</span> my_database

To upgrade this helm chart:

  1. Obtain the password as described on the <span class="s1">'Administrator credentials'</span> section and <span class="nb">set </span>the <span class="s1">'rootUser.password'</span> parameter as shown below:

      <span class="nv">ROOT_PASSWORD</span><span class="o">=</span><span class="si">$(</span>kubectl get secret <span class="nt">--namespace</span> default right-termite-mariadb <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">"{.data.mariadb-root-password}"</span> | <span class="nb">base64</span> <span class="nt">--decode</span><span class="si">)</span>
      helm upgrade right-termite stable/mariadb <span class="nt">--set</span> rootUser.password<span class="o">=</span><span class="nv">$ROOT_PASSWORD</span>
</pre></table></code></div></div><ul><li>maria db 패스워드 알아내서 mariadb client 설치하여 확인해보기</ul><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="c"># maria db 패스워드</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl get secret <span class="nt">-n</span> default  right-termite-mariadb  <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">"{.data.mariadb-root-password}"</span>  | <span class="nb">base64</span> <span class="nt">--decode</span>
x2SwMMZow8

<span class="c"># 자! 이제 mariadb client를 깔고 확인해보자. ubuntu 이미지를 하나 설치 하여 mariadb client 설치한다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl run <span class="nt">-i</span> <span class="nt">--tty</span> ubuntu <span class="nt">--image</span><span class="o">=</span>ubuntu:16.04 <span class="nt">--restart</span><span class="o">=</span>Never <span class="nt">--</span> bash <span class="nt">-il</span>
If you <span class="k">do </span>not see a <span class="nb">command </span>prompt, try pressing enter.
root@ubuntu:/# apt-get update<span class="p">;</span> apt-get <span class="nb">install</span> <span class="nt">-y</span> mariadb-client
root@ubuntu:/# mysql <span class="nt">-h</span> right-termite-mariadb <span class="nt">-p</span>
Enter password:x2SwMMZow8
Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span><span class="nb">.</span>
Your MariaDB connection <span class="nb">id </span>is 132
Server version: 10.3.22-MariaDB-log Source distribution

Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type <span class="s1">'help;'</span> or <span class="s1">'\h'</span> <span class="k">for </span>help. Type <span class="s1">'\c'</span> to clear the current input statement.

MariaDB <span class="o">[(</span>none<span class="o">)]&gt;</span> show databases<span class="p">;</span>
+--------------------+
| Database           |
+--------------------+
| information_schema |
| my_database        |
| mysql              |
| performance_schema |
| <span class="nb">test</span>               |
+--------------------+
5 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>

MariaDB <span class="o">[(</span>none<span class="o">)]&gt;</span>
MariaDB <span class="o">[(</span>none<span class="o">)]&gt;</span> quit
Bye
root@ubuntu:/# <span class="nb">exit
logout</span>
</pre></table></code></div></div><ul><li>helm 설치 한거 삭제해보자</ul><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c"># helm list</span>
ps0107@k8smaster1:~<span class="nv">$ </span>helm list <span class="nt">-a</span>
NAME         	REVISION	UPDATED                 	STATUS  	CHART        	APP VERSION	NAMESPACE
right-termite	1       	Sat Feb  8 15:47:33 2020	DEPLOYED	mariadb-7.3.7	10.3.22    	default

<span class="c"># 생성한 helm 삭제</span>
ps0107@k8smaster1:~<span class="nv">$ </span>helm delete right-termite
release <span class="s2">"right-termite"</span> deleted

<span class="c"># 삭제 확인</span>
ps0107@k8smaster1:~<span class="nv">$ </span>helm list
</pre></table></code></div></div><ul><li>이번엔 지워진 mariadb를 다운로드된 chart를 이용하여 패스워드를 수정하고 다시 설치해보자.</ul><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
</pre><td class="rouge-code"><pre><span class="c"># 이번엔 지워진 mariadb를 다운로드된 chart를 이용하여 패스워드를 수정하고 다시 설치해보자.</span>
<span class="c"># 다운로드 된 chart를 찾는다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>find ~ <span class="nt">-name</span> <span class="k">*</span>mariadb<span class="k">*</span>
/home/ps0107/.helm/cache/archive/mariadb-7.3.7.tgz

ps0107@k8smaster1:~<span class="nv">$ </span><span class="nb">cd</span> /home/ps0107/.helm/cache/archive/

ps0107@k8smaster1:~/.helm/cache/archive<span class="nv">$ </span><span class="nb">tar</span> <span class="nt">-xvf</span> mariadb-7.3.7.tgz
mariadb/Chart.yaml
mariadb/values.yaml
mariadb/templates/NOTES.txt
mariadb/templates/_helpers.tpl
mariadb/templates/initialization-configmap.yaml
mariadb/templates/master-configmap.yaml
mariadb/templates/master-pdb.yaml
mariadb/templates/master-statefulset.yaml
mariadb/templates/master-svc.yaml
mariadb/templates/role.yaml
mariadb/templates/rolebinding.yaml
mariadb/templates/secrets.yaml
mariadb/templates/serviceaccount.yaml
mariadb/templates/servicemonitor.yaml
mariadb/templates/slave-configmap.yaml
mariadb/templates/slave-pdb.yaml
mariadb/templates/slave-statefulset.yaml
mariadb/templates/slave-svc.yaml
mariadb/templates/test-runner.yaml
mariadb/templates/tests.yaml
mariadb/.helmignore
mariadb/OWNERS
mariadb/README.md
mariadb/files/docker-entrypoint-initdb.d/README.md
mariadb/values-production.yaml
mariadb/values.schema.json

ps0107@k8smaster1:~/.helm/cache/archive<span class="nv">$ </span><span class="nb">cp </span>mariadb/values.yaml ~/custom.yaml <span class="p">;</span> <span class="nb">cd

</span>ps0107@k8smaster1:~<span class="nv">$ </span>vi custom.yaml
	rootUser:
	  <span class="c">## MariaDB admin password</span>
	  <span class="c">## ref: https://github.com/bitnami/bitnami-docker-mariadb#setting-the-root-password-on-first-run</span>
	  <span class="c">##</span>
	  password: qwe123.  <span class="c"># &lt;- 수정</span>


	  persistence:
	    <span class="c">## If true, use a Persistent Volume Claim, If false, use emptyDir</span>
	    <span class="c">##</span>
	    enabled: false. <span class="c">#&lt;- 수정</span>

<span class="c"># 수정된 chart로 mariadb 인스톨</span>
ps0107@k8smaster1:~<span class="nv">$ </span>helm <span class="nb">install</span> <span class="nt">-f</span> custom.yaml stable/mariadb
NAME:   snug-aardvark
LAST DEPLOYED: Sat Feb  8 16:21:53 2020
NAMESPACE: default
STATUS: DEPLOYED

RESOURCES:
<span class="o">==&gt;</span> v1/ConfigMap
NAME                          AGE
snug-aardvark-mariadb-master  1s
snug-aardvark-mariadb-slave   1s
snug-aardvark-mariadb-tests   1s

<span class="o">==&gt;</span> v1/Pod<span class="o">(</span>related<span class="o">)</span>
NAME                            AGE
snug-aardvark-mariadb-master-0  1s
snug-aardvark-mariadb-slave-0   1s

<span class="o">==&gt;</span> v1/Secret
NAME                   AGE
snug-aardvark-mariadb  1s

<span class="o">==&gt;</span> v1/Service
NAME                         AGE
snug-aardvark-mariadb        1s
snug-aardvark-mariadb-slave  1s

<span class="o">==&gt;</span> v1/StatefulSet
NAME                          AGE
snug-aardvark-mariadb-master  1s
snug-aardvark-mariadb-slave   1s


NOTES:

Please be patient <span class="k">while </span>the chart is being deployed

Tip:

  Watch the deployment status using the <span class="nb">command</span>: kubectl get pods <span class="nt">-w</span> <span class="nt">--namespace</span> default <span class="nt">-l</span> <span class="nv">release</span><span class="o">=</span>snug-aardvark

Services:

  <span class="nb">echo </span>Master: snug-aardvark-mariadb.default.svc.cluster.local:3306
  <span class="nb">echo </span>Slave:  snug-aardvark-mariadb-slave.default.svc.cluster.local:3306

Administrator credentials:

  Username: root
  Password : <span class="si">$(</span>kubectl get secret <span class="nt">--namespace</span> default snug-aardvark-mariadb <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">"{.data.mariadb-root-password}"</span> | <span class="nb">base64</span> <span class="nt">--decode</span><span class="si">)</span>

To connect to your database:

  1. Run a pod that you can use as a client:

      kubectl run snug-aardvark-mariadb-client <span class="nt">--rm</span> <span class="nt">--tty</span> <span class="nt">-i</span> <span class="nt">--restart</span><span class="o">=</span><span class="s1">'Never'</span> <span class="nt">--image</span>  docker.io/bitnami/mariadb:10.3.22-debian-10-r0 <span class="nt">--namespace</span> default <span class="nt">--command</span> <span class="nt">--</span> bash

  2. To connect to master service <span class="o">(</span><span class="nb">read</span>/write<span class="o">)</span>:

      mysql <span class="nt">-h</span> snug-aardvark-mariadb.default.svc.cluster.local <span class="nt">-uroot</span> <span class="nt">-p</span> my_database

  3. To connect to slave service <span class="o">(</span>read-only<span class="o">)</span>:

      mysql <span class="nt">-h</span> snug-aardvark-mariadb-slave.default.svc.cluster.local <span class="nt">-uroot</span> <span class="nt">-p</span> my_database

To upgrade this helm chart:

  1. Obtain the password as described on the <span class="s1">'Administrator credentials'</span> section and <span class="nb">set </span>the <span class="s1">'rootUser.password'</span> parameter as shown below:

      <span class="nv">ROOT_PASSWORD</span><span class="o">=</span><span class="si">$(</span>kubectl get secret <span class="nt">--namespace</span> default snug-aardvark-mariadb <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">"{.data.mariadb-root-password}"</span> | <span class="nb">base64</span> <span class="nt">--decode</span><span class="si">)</span>
      helm upgrade snug-aardvark stable/mariadb <span class="nt">--set</span> rootUser.password<span class="o">=</span><span class="nv">$ROOT_PASSWORD</span>
</pre></table></code></div></div><ul><li>설치가 잘되었다면, mariadb client를 사용하여 접속해보자. 이번엔 수정한 패스워드로 접속이 잘되어야 한다.</ul><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="c"># mariadb client를 생성하여 다시 접속해보자. 수정한 password로 잘 접속이 되어야 한다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl run <span class="nt">-i</span> <span class="nt">--tty</span> ubuntu2 <span class="nt">--image</span><span class="o">=</span>ubuntu:16.04 <span class="nt">--restart</span><span class="o">=</span>Never <span class="nt">--</span> bash <span class="nt">-il</span>
root@ubuntu2:/# apt-get update<span class="p">;</span> apt-get <span class="nb">install</span> <span class="nt">-y</span> mariadb-client
Get:1 http://security.ubuntu.com/ubuntu xenial-security InRelease <span class="o">[</span>109 kB]
Get:2 http://archive.ubuntu.com/ubuntu xenial InRelease <span class="o">[</span>247 kB]
.....
root@ubuntu2:/# mysql <span class="nt">-h</span> snug-aardvark-mariadb <span class="nt">-uroot</span> <span class="nt">-p</span>
Enter password:qwe123
Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span><span class="nb">.</span>
Your MariaDB connection <span class="nb">id </span>is 38
Server version: 10.3.22-MariaDB-log Source distribution

Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type <span class="s1">'help;'</span> or <span class="s1">'\h'</span> <span class="k">for </span>help. Type <span class="s1">'\c'</span> to clear the current input statement.

MariaDB <span class="o">[(</span>none<span class="o">)]&gt;</span> show databases<span class="p">;</span>
+--------------------+
| Database           |
+--------------------+
| information_schema |
| my_database        |
| mysql              |
| performance_schema |
| <span class="nb">test</span>               |
+--------------------+
5 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>

MariaDB <span class="o">[(</span>none<span class="o">)]&gt;</span> <span class="nb">exit
</span>Bye
root@ubuntu2:/# <span class="nb">exit
logout</span>
</pre></table></code></div></div><h2 id="다른-repo-등록과-search-해보기">다른 repo 등록과 search 해보기</h2><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="c"># 다른 repository 를 추가하고 이용할 수 있는 Charts를 볼수 있다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>helm repo add common  http://storage.googleapis.com/kubernetes-charts
<span class="s2">"common"</span> has been added to your repositories

<span class="c"># helm repo list 확인</span>
ps0107@k8smaster1:~<span class="nv">$ </span>helm repo list
NAME  	URL
stable	https://kubernetes-charts.storage.googleapis.com
<span class="nb">local 	</span>http://127.0.0.1:8879/charts
common	http://storage.googleapis.com/kubernetes-charts

<span class="c"># helm search를 통한 확인</span>
ps0107@k8smaster1:~<span class="nv">$ </span>helm search
NAME                                 	CHART VERSION	APP VERSION            	DESCRIPTION
common/acs-engine-autoscaler         	2.2.2        	2.1.1                  	DEPRECATED Scales worker nodes within agent pools
common/aerospike                     	0.3.2        	v4.5.0.5               	A Helm chart <span class="k">for </span>Aerospike <span class="k">in </span>Kubernetes
common/airflow                       	6.0.0        	1.10.4                 	Airflow is a platform to programmatically author, schedul...
common/ambassador                    	5.3.1        	0.86.1                 	A Helm chart <span class="k">for </span>Datawire Ambassador
common/anchore-engine                	1.4.2        	0.6.1                  	Anchore container analysis and policy evaluation engine s...
common/apm-server                    	2.1.5        	7.0.0                  	The server receives data from the Elastic APM agents and ...
.......
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/kubernetes/'>Kubernetes</a>, <a href='/categories/kubernetes-administration-course/'>Kubernetes Administration Course</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >kubernetes</a> <a href="/tags/cka/" class="post-tag no-text-decoration" >cka</a> <a href="/tags/lfs458/" class="post-tag no-text-decoration" >LFS458</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[kubernetes-실습] helm - ps's Blog&url=https://ps2046.github.io/posts/21.kubernetes_helm/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[kubernetes-실습] helm - ps's Blog&u=https://ps2046.github.io/posts/21.kubernetes_helm/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=[kubernetes-실습] helm - ps's Blog&url=https://ps2046.github.io/posts/21.kubernetes_helm/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/blog-comments-utterances/">[blog] github blog comments (utterances)</a><li><a href="/posts/17.kubernetes_Scheduling_2/">[kubernetes-실습] Scheduling - Taint를 이용한 pod 배포 관리</a><li><a href="/posts/18.kubernetes_logging_trubleshooting_1/">[kubernetes-실습] 로깅과 트러블슈팅 : 로그위치와 로그 출력 보기</a><li><a href="/posts/19.kubernetes_logging_trubleshooting_2/">[kubernetes-실습] 로깅과 트러블슈팅 : Metrics와 DashBoard</a><li><a href="/posts/20.kubernetes_crd/">[kubernetes-실습] CRD (Custom Resource Definition)</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cka/">cka</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/lfs458/">LFS458</a> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/comments/">comments</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/monitoring/">monitoring</a> <a class="post-tag" href="/tags/system/">system</a> <a class="post-tag" href="/tags/utterances/">utterances</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/17.kubernetes_Scheduling_2/"><div class="card-body"> <span class="timeago small" >Jan 26<i class="unloaded">2021-01-26T08:30:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[kubernetes-실습] Scheduling - Taint를 이용한 pod 배포 관리</h3><div class="text-muted small"><p> Using Taints to Control Pod Deployment taints를 사용하여 어느곳에 pod가 배치되거나 실행을 허용하도록 관리할수 있다. 노드 그룹에 pod들을 할당하여 추가할때 노드 사용을 제한하거나 pod들을 완전히 대피시킬수 있다. 참고 마스터노드가 처음에 NoSchedule taint로 설정되어 있었던것을 기억할 것이다...</p></div></div></a></div><div class="card"> <a href="/posts/18.kubernetes_logging_trubleshooting_1/"><div class="card-body"> <span class="timeago small" >Jan 26<i class="unloaded">2021-01-26T09:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[kubernetes-실습] 로깅과 트러블슈팅 : 로그위치와 로그 출력 보기</h3><div class="text-muted small"><p> 로그 파일들의 위치 알아보기 다양한 로그 파일과 명령 출력 이외에도 journalctl을 사용하여 노드 관점에서 로그를 볼 수 있다. 우리는 로그 파일의 공통적인 위치를 보고, 컨테이너 로그를 보는 명령을 볼 것이다. 다른 컨테이너의 로그를 pod에 적재하는데 전용으로 사용되는 sidecar container의 사용과 같은 다른 로깅 ...</p></div></div></a></div><div class="card"> <a href="/posts/19.kubernetes_logging_trubleshooting_2/"><div class="card-body"> <span class="timeago small" >Jan 26<i class="unloaded">2021-01-26T10:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[kubernetes-실습] 로깅과 트러블슈팅 : Metrics와 DashBoard</h3><div class="text-muted small"><p> Metrics 설정 heapster가 deprecation 되면서 Metrics Server 와 통합되어 개발되고 배포되어지고 있다. 그리고 CNCF의 프로젝트중 프로메테우스도 잘 사용되어지고 있다. # --------------------------------- # Metrics 설정 # ----------------------------...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/20.kubernetes_crd/" class="btn btn-outline-primary" prompt="Older"><p>[kubernetes-실습] CRD (Custom Resource Definition)</p></a> <a href="/posts/22.kubernetes_Security_TLS/" class="btn btn-outline-primary" prompt="Newer"><p>[kubernetes-실습] Security - TLS</p></a></div><script src="https://utteranc.es/client.js" repo="ps2046/ps2046-github-io-comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async> </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://ps2046.github.io">ps.jang</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/cka/">cka</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/lfs458/">LFS458</a> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/comments/">comments</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/monitoring/">monitoring</a> <a class="post-tag" href="/tags/system/">system</a> <a class="post-tag" href="/tags/utterances/">utterances</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://ps2046.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-158837927-2"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-158837927-2'); }); </script>
