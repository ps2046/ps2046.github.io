<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="[kubernetes-실습] HA(High Availability) 구성 - master node" /><meta property="og:locale" content="en" /><meta name="description" content="kubernetes 인증 시험(CKA)에 대비하기 위해 실습을 해보도록 한다." /><meta property="og:description" content="kubernetes 인증 시험(CKA)에 대비하기 위해 실습을 해보도록 한다." /><link rel="canonical" href="https://ps2046.github.io/posts/24.kubernetes_HA/" /><meta property="og:url" content="https://ps2046.github.io/posts/24.kubernetes_HA/" /><meta property="og:site_name" content="ps’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-01-26T15:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[kubernetes-실습] HA(High Availability) 구성 - master node" /><meta name="twitter:site" content="@ps2046" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"kubernetes 인증 시험(CKA)에 대비하기 위해 실습을 해보도록 한다.","headline":"[kubernetes-실습] HA(High Availability) 구성 - master node","dateModified":"2021-08-26T00:00:00+09:00","url":"https://ps2046.github.io/posts/24.kubernetes_HA/","datePublished":"2021-01-26T15:00:00+09:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://ps2046.github.io/posts/24.kubernetes_HA/"},"@context":"https://schema.org"}</script><title>[kubernetes-실습] HA(High Availability) 구성 - master node | ps's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ps's Blog"><meta name="application-name" content="ps's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7635228999568716" crossorigin="anonymous"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/11029548?s=400&u=5ebc191faa53e931968ec2ed98bd7c7b68136c71&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">ps's Blog</a></div><div class="site-subtitle font-italic">System Engineer & Developer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/ps2046" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/ps2046" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ps2046.jang','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[kubernetes-실습] HA(High Availability) 구성 - master node</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[kubernetes-실습] HA(High Availability) 구성 - master node</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> ps.jang </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Jan 26, 2021, 3:00 PM +0900" >Jan 26<i class="unloaded">2021-01-26T15:00:00+09:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, Aug 26, 2021, 12:00 AM +0000" >Aug 26<i class="unloaded">2021-08-26T00:00:00+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2987 words">16 min read</span></div></div><div class="post-content"><h2 id="master-node-2대를-추가해-ha-구성을-해보자">master node 2대를 추가해 H.A 구성을 해보자.</h2><h3 id="-방법-">[ 방법 ]</h3><ol><li>트래픽을 받도록 load balancer로 배포한다. HAProxy는 배포가 쉬운편이다. start하여 현재 동작중인 master node를 확인한다.<li>k8smaster2,3번 노드에 kubernetes software를 설치한다. (이 과정은 기존 worker node를 이미지 떠서 만들면 더 편할 듯하다.)<li>k8smaster2번을 master node에 join 한다. 기존에 worker node 추가때 사용하던 kubeadm join 으로 부터 추가적으로 hash와 flag가 필요할 것이다.<li>k8smaster3번을 master node에 join 한다.<li>haproxy에 3개의 master를 사용하도록 설정을 수정하여 재시작한다.<li>트래픽 및 모니터링 화면을 통해 제대로 분배되어 들어오는지 확인한다.</ol><h3 id="-준비사항-">[ 준비사항 ]</h3><ul><li>3개의 노드 준비 (proxy node, k8smaster2, k8smaster3)</ul><hr /><h2 id="haproxy-master2-master3-세팅">haproxy, master2, master3 세팅</h2><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="c"># 계정 추가 및 세팅</span>
<span class="nv">$ </span>useradd <span class="nt">-s</span> /bin/bash <span class="nt">-m</span> ps0107

<span class="nv">$ </span>passwd ps0107

<span class="nv">$ </span>vi /etc/sudoers.d/ps0107
  ps0107 <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> ALL

<span class="nv">$ </span><span class="nb">chmod </span>440 /etc/sudoers.d/ps0107

<span class="nv">$ </span>vi /etc/sudoers
  %sudo   <span class="nv">ALL</span><span class="o">=(</span>ALL:ALL<span class="o">)</span> NOPASSWD: ALL

<span class="nv">$ </span>vi /etc/ssh/sshd_config
  PasswordAuthentication <span class="nb">yes</span>

<span class="nv">$ </span>service ssh restart

<span class="nv">$ </span>vi /etc/hosts
10.146.0.2   k8smaster   master 
10.146.0.13  k8smaster2  master2
10.146.0.14  k8smaster3  master3
10.146.0.4   k8sworker1  worker1

<span class="nv">$ </span>apt-get update <span class="o">&amp;&amp;</span> apt-get upgrade <span class="nt">-y</span>

<span class="c">#### master2,3번은 docker 및 kubernetes software 설치</span>
<span class="nv">$ </span>apt-get <span class="nb">install</span> <span class="nt">-y</span> docker.io

<span class="nv">$ </span>vi /etc/apt/sources.list.d/kubernetes.list
  deb http://apt.kubernetes.io/ kubernetes-xenial main

<span class="nv">$ </span>curl <span class="nt">-s</span> https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -

<span class="nv">$ </span>apt-get update

<span class="nv">$ </span>apt-get <span class="nb">install</span> <span class="nt">-y</span> <span class="nv">kubeadm</span><span class="o">=</span>1.15.1-00 <span class="nv">kubelet</span><span class="o">=</span>1.15.1-00 <span class="nv">kubectl</span><span class="o">=</span>1.15.1-00
</pre></table></code></div></div><hr /><h2 id="haproxy-설치">haproxy 설치</h2><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
</pre><td class="rouge-code"><pre><span class="c">###################################</span>
<span class="c"># haproxy 설치</span>
<span class="c">###################################</span>
<span class="c"># haproxy install</span>
ps0107@proxy:~<span class="nv">$ </span><span class="nb">sudo </span>apt-get update <span class="p">;</span> <span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="nt">-y</span> apache2 haproxy

<span class="c"># haproxy 설정 변경</span>
ps0107@proxy:~<span class="nv">$ </span><span class="nb">sudo </span>vi /etc/haproxy/haproxy.cfg
global
	log /dev/log	local0
	log /dev/log	local1 notice
	<span class="nb">chroot</span> /var/lib/haproxy
	stats socket /run/haproxy/admin.sock mode 660 level admin
	stats <span class="nb">timeout </span>30s
	user haproxy
	group haproxy
	daemon

	<span class="c"># Default SSL material locations</span>
	ca-base /etc/ssl/certs
	crt-base /etc/ssl/private

	<span class="c"># Default ciphers to use on SSL-enabled listening sockets.</span>
	<span class="c"># For more information, see ciphers(1SSL). This list is from:</span>
	<span class="c">#  https://hynek.me/articles/hardening-your-web-servers-ssl-ciphers/</span>
	ssl-default-bind-ciphers ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:ECDH+3DES:DH+3DES:RSA+AESGCM:RSA+AES:RSA+3DES:!aNULL:!MD5:!DSS
	ssl-default-bind-options no-sslv3

defaults
	log	global
	mode	tcp
	option	tcplog
	option	dontlognull
        <span class="nb">timeout </span>connect 5000
        <span class="nb">timeout </span>client  50000
        <span class="nb">timeout </span>server  50000
	errorfile 400 /etc/haproxy/errors/400.http
	errorfile 403 /etc/haproxy/errors/403.http
	errorfile 408 /etc/haproxy/errors/408.http
	errorfile 500 /etc/haproxy/errors/500.http
	errorfile 502 /etc/haproxy/errors/502.http
	errorfile 503 /etc/haproxy/errors/503.http
	errorfile 504 /etc/haproxy/errors/504.http

frontend proxynode
   <span class="nb">bind</span> <span class="k">*</span>:80
   <span class="nb">bind</span> <span class="k">*</span>:6443
   stats uri /proxystats
   default_backend k8sServers

backend k8sServers
   balance roundrobin
   server master1  10.146.0.2:6443 check
<span class="c">#  server master2  10.128.0.30:6443 check</span>
<span class="c">#  server master3  10.128.0.66:6443 check</span>

listen stats
     <span class="nb">bind</span> :9999
     mode http
     stats <span class="nb">enable
     </span>stats hide-version
     stats uri /stats

<span class="c"># 설정 변경 후 재시작</span>
ps0107@proxy:~<span class="nv">$ </span><span class="nb">sudo </span>service haproxy restart

<span class="c"># 재시작 및 상태 확인</span>
ps0107@proxy:~<span class="nv">$ </span><span class="nb">sudo </span>service haproxy status
● haproxy.service - HAProxy Load Balancer
   Loaded: loaded <span class="o">(</span>/lib/systemd/system/haproxy.service<span class="p">;</span> enabled<span class="p">;</span> vendor preset: enabled<span class="o">)</span>
   Active: active <span class="o">(</span>running<span class="o">)</span> since Tue 2020-02-18 06:02:59 UTC<span class="p">;</span> 9s ago
     Docs: man:haproxy<span class="o">(</span>1<span class="o">)</span>
           file:/usr/share/doc/haproxy/configuration.txt.gz
  Process: 4116 <span class="nv">ExecStartPre</span><span class="o">=</span>/usr/sbin/haproxy <span class="nt">-f</span> <span class="nv">$CONFIG</span> <span class="nt">-c</span> <span class="nt">-q</span> <span class="nv">$EXTRAOPTS</span> <span class="o">(</span><span class="nv">code</span><span class="o">=</span>exited, <span class="nv">status</span><span class="o">=</span>0/SUCCESS<span class="o">)</span>
Main PID: 4118 <span class="o">(</span>haproxy-systemd<span class="o">)</span>
    Tasks: 3 <span class="o">(</span>limit: 4915<span class="o">)</span>
   CGroup: /system.slice/haproxy.service
           ├─4118 /usr/sbin/haproxy-systemd-wrapper <span class="nt">-f</span> /etc/haproxy/haproxy.cfg <span class="nt">-p</span> /run/haproxy.pid
           ├─4121 /usr/sbin/haproxy-master
           └─4122 /usr/sbin/haproxy <span class="nt">-f</span> /etc/haproxy/haproxy.cfg <span class="nt">-p</span> /run/haproxy.pid <span class="nt">-Ds</span>

Feb 18 06:02:59 proxy systemd[1]: Starting HAProxy Load Balancer...
Feb 18 06:02:59 proxy systemd[1]: Started HAProxy Load Balancer.
Feb 18 06:02:59 proxy haproxy-systemd-wrapper[4118]: haproxy-systemd-wrapper: executing /usr/sbin/haproxy <span class="nt">-f</span> /etc/haproxy/haproxy.cfg <span class="nt">-p</span> /run/haproxy.pid <span class="nt">-Ds</span>
Feb 18 06:02:59 proxy haproxy[4121]: Proxy proxynode started.
Feb 18 06:02:59 proxy haproxy[4121]: Proxy proxynode started.
Feb 18 06:02:59 proxy haproxy[4121]: Proxy k8sServers started.
Feb 18 06:02:59 proxy haproxy[4121]: Proxy k8sServers started.
</pre></table></code></div></div><hr /><h2 id="haproxy-동작-확인-현재는-master1번만-backend">haproxy 동작 확인 (현재는 master1번만 backend)</h2><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="c"># 이제 master1의 hosts파일을 수정하여 k8smaster가 haproxy 로 가도록 아이피를 수정해준다.</span>
<span class="c"># haproxy 에서 현재 설정된대로 master1번 으로 호출하게 될것이다.</span>

<span class="c"># hosts파일 수정</span>
ps0107@k8smaster1:~/.ssh<span class="nv">$ </span><span class="nb">cat</span> /etc/hosts
127.0.0.1 localhost
<span class="c">#10.146.0.2  k8smaster  master</span>
10.146.0.9  k8smaster   master

<span class="c"># haproxy stats 웹페이지 접속</span>
http://35.243.70.115:9999/stats

<span class="c"># kubectl 명령을 여러번 호출 한 후 웹페이지를 확인해 본다.</span>
ps0107@k8smaster1:~/lab/LFS458/SOLUTIONS/s_16<span class="nv">$ </span>kubectl get node
NAME         STATUS   ROLES    AGE   VERSION
k8smaster1   Ready    master   21d   v1.15.1
k8sworker1   Ready    &lt;none&gt;   21d   v1.15.1
</pre></table></code></div></div><ul><li>http://35.243.70.115:9999/stats 로 접속하면 HAProxy Status 화면을 볼수 있다.<li>현재는 master node 1개가 backend로 연결되어 있다.</ul><p><img data-proofer-ignore data-src="/assets/images/kubernetes/kubernetes-administration/ha1.png" alt="ha" /></p><hr /><h2 id="master-1번-노드에서-token-과-ssl-hash-생성">master 1번 노드에서 token 과 SSL hash 생성</h2><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="c">###############################################</span>
<span class="c"># master 1번 노드에서 token 과 SSL hash 생성</span>
<span class="c">###############################################</span>
<span class="c"># 조인을 위해 master1번서버에서 token들과 hash</span>

<span class="c"># master1번 아이피를 haproxy 서버 아이피로 변경한다</span>
ps0107@k8smaster2:~<span class="nv">$ </span><span class="nb">sudo </span>vi /etc/hosts

<span class="c"># master1번 서버에서 token 생성</span>
ps0107@k8smaster1:~<span class="nv">$ </span><span class="nb">sudo </span>kubeadm token create
nmub4r.x6pnwhwicqosxtbn

<span class="c"># SSL hash 생성</span>
ps0107@k8smaster1:~<span class="nv">$ </span>openssl x509 <span class="nt">-pubkey</span> <span class="se">\</span>
<span class="o">&gt;</span> <span class="nt">-in</span> /etc/kubernetes/pki/ca.crt | openssl rsa <span class="se">\ </span>                                                                                     
<span class="o">&gt;</span> <span class="nt">-pubin</span> <span class="nt">-outform</span> der 2&gt;/dev/null | openssl dgst <span class="se">\</span>
<span class="o">&gt;</span> <span class="nt">-sha256</span> <span class="nt">-hex</span> | <span class="nb">sed</span> <span class="s1">'s/^.* //'</span>
16e1304347fa2f5cb6f1660e582ed3501aa63e0ddce276773566098aef13d0ba

<span class="c"># worker node가 아니라 master node로 join 하기 위해 신규 master certificate를 생성한다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span><span class="nb">sudo </span>kubeadm init phase upload-certs <span class="nt">--upload-certs</span>
I0219 01:57:13.393987    9787 version.go:248] remote version is much newer: v1.17.3<span class="p">;</span> falling back to: stable-1.15
<span class="o">[</span>upload-certs] Storing the certificates <span class="k">in </span>Secret <span class="s2">"kubeadm-certs"</span> <span class="k">in </span>the <span class="s2">"kube-system"</span> Namespace
<span class="o">[</span>upload-certs] Using certificate key:
d3bc0cd2c943fafe26e0dc5903ae41669993b7cbfbb7c4b5cc6336bb99a2e365
</pre></table></code></div></div><hr /><h2 id="master-2번-노드에서-master로-클러스터-조인-수행">master 2번 노드에서 master로 클러스터 조인 수행</h2><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
</pre><td class="rouge-code"><pre><span class="c">###############################################</span>
<span class="c"># master 2번 노드에서 master로 클러스터 조인 수행</span>
<span class="c">###############################################</span>
<span class="c"># master2번 노드에서 join 수행</span>
ps0107@k8smaster2:~<span class="nv">$ </span><span class="nb">sudo </span>kubeadm <span class="nb">join </span>k8smaster:6443 ￦
<span class="o">&gt;</span> <span class="nt">--token</span> nmub4r.x6pnwhwicqosxtbn ￦
<span class="o">&gt;</span> <span class="nt">--discovery-token-ca-cert-hash</span> sha256:16e1304347fa2f5cb6f1660e582ed3501aa63e0ddce276773566098aef13d0ba ￦
<span class="o">&gt;</span> <span class="nt">--control-plane</span> <span class="nt">--certificate-key</span> d3bc0cd2c943fafe26e0dc5903ae41669993b7cbfbb7c4b5cc6336bb99a2e365

<span class="o">[</span>preflight] Running pre-flight checks
<span class="o">[</span>WARNING IsDockerSystemdCheck]: detected <span class="s2">"cgroupfs"</span> as the Docker cgroup driver. The recommended driver is <span class="s2">"systemd"</span><span class="nb">.</span> Please follow the guide at https://kubernetes.io/docs/setup/cri/
<span class="o">[</span>preflight] Reading configuration from the cluster...
<span class="o">[</span>preflight] FYI: You can look at this config file with <span class="s1">'kubectl -n kube-system get cm kubeadm-config -oyaml'</span>
<span class="o">[</span>preflight] Running pre-flight checks before initializing the new control plane instance
<span class="o">[</span>preflight] Pulling images required <span class="k">for </span>setting up a Kubernetes cluster
<span class="o">[</span>preflight] This might take a minute or two, depending on the speed of your internet connection
<span class="o">[</span>preflight] You can also perform this action <span class="k">in </span>beforehand using <span class="s1">'kubeadm config images pull'</span>
<span class="o">[</span>download-certs] Downloading the certificates <span class="k">in </span>Secret <span class="s2">"kubeadm-certs"</span> <span class="k">in </span>the <span class="s2">"kube-system"</span> Namespace
<span class="o">[</span>certs] Using certificateDir folder <span class="s2">"/etc/kubernetes/pki"</span>
<span class="o">[</span>certs] Generating <span class="s2">"etcd/healthcheck-client"</span> certificate and key
<span class="o">[</span>certs] Generating <span class="s2">"etcd/server"</span> certificate and key
<span class="o">[</span>certs] etcd/server serving cert is signed <span class="k">for </span>DNS names <span class="o">[</span>k8smaster2 localhost] and IPs <span class="o">[</span>10.146.0.13 127.0.0.1 ::1]
<span class="o">[</span>certs] Generating <span class="s2">"apiserver-etcd-client"</span> certificate and key
<span class="o">[</span>certs] Generating <span class="s2">"etcd/peer"</span> certificate and key
<span class="o">[</span>certs] etcd/peer serving cert is signed <span class="k">for </span>DNS names <span class="o">[</span>k8smaster2 localhost] and IPs <span class="o">[</span>10.146.0.13 127.0.0.1 ::1]
<span class="o">[</span>certs] Generating <span class="s2">"apiserver-kubelet-client"</span> certificate and key
<span class="o">[</span>certs] Generating <span class="s2">"apiserver"</span> certificate and key
<span class="o">[</span>certs] apiserver serving cert is signed <span class="k">for </span>DNS names <span class="o">[</span>k8smaster2 kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local k8smaster] and IPs <span class="o">[</span>10.96.0.1 10.146.0.13]
<span class="o">[</span>certs] Generating <span class="s2">"front-proxy-client"</span> certificate and key
<span class="o">[</span>certs] Valid certificates and keys now exist <span class="k">in</span> <span class="s2">"/etc/kubernetes/pki"</span>
<span class="o">[</span>certs] Using the existing <span class="s2">"sa"</span> key
<span class="o">[</span>kubeconfig] Generating kubeconfig files
<span class="o">[</span>kubeconfig] Using kubeconfig folder <span class="s2">"/etc/kubernetes"</span>
<span class="o">[</span>kubeconfig] Writing <span class="s2">"admin.conf"</span> kubeconfig file
<span class="o">[</span>kubeconfig] Writing <span class="s2">"controller-manager.conf"</span> kubeconfig file
<span class="o">[</span>kubeconfig] Writing <span class="s2">"scheduler.conf"</span> kubeconfig file
<span class="o">[</span>control-plane] Using manifest folder <span class="s2">"/etc/kubernetes/manifests"</span>
<span class="o">[</span>control-plane] Creating static Pod manifest <span class="k">for</span> <span class="s2">"kube-apiserver"</span>
<span class="o">[</span>control-plane] Creating static Pod manifest <span class="k">for</span> <span class="s2">"kube-controller-manager"</span>
<span class="o">[</span>control-plane] Creating static Pod manifest <span class="k">for</span> <span class="s2">"kube-scheduler"</span>
<span class="o">[</span>check-etcd] Checking that the etcd cluster is healthy
<span class="o">[</span>kubelet-start] Downloading configuration <span class="k">for </span>the kubelet from the <span class="s2">"kubelet-config-1.15"</span> ConfigMap <span class="k">in </span>the kube-system namespace
<span class="o">[</span>kubelet-start] Writing kubelet configuration to file <span class="s2">"/var/lib/kubelet/config.yaml"</span>
<span class="o">[</span>kubelet-start] Writing kubelet environment file with flags to file <span class="s2">"/var/lib/kubelet/kubeadm-flags.env"</span>
<span class="o">[</span>kubelet-start] Activating the kubelet service
<span class="o">[</span>kubelet-start] Waiting <span class="k">for </span>the kubelet to perform the TLS Bootstrap...
<span class="o">[</span>etcd] Announced new etcd member joining to the existing etcd cluster
<span class="o">[</span>etcd] Wrote Static Pod manifest <span class="k">for </span>a <span class="nb">local </span>etcd member to <span class="s2">"/etc/kubernetes/manifests/etcd.yaml"</span>
<span class="o">[</span>etcd] Waiting <span class="k">for </span>the new etcd member to <span class="nb">join </span>the cluster. This can take up to 40s
<span class="o">[</span>upload-config] Storing the configuration used <span class="k">in </span>ConfigMap <span class="s2">"kubeadm-config"</span> <span class="k">in </span>the <span class="s2">"kube-system"</span> Namespace
<span class="o">[</span>mark-control-plane] Marking the node k8smaster2 as control-plane by adding the label <span class="s2">"node-role.kubernetes.io/master=''"</span>
<span class="o">[</span>mark-control-plane] Marking the node k8smaster2 as control-plane by adding the taints <span class="o">[</span>node-role.kubernetes.io/master:NoSchedule]

This node has joined the cluster and a new control plane instance was created:

<span class="k">*</span> Certificate signing request was sent to apiserver and approval was received.
<span class="k">*</span> The Kubelet was informed of the new secure connection details.
<span class="k">*</span> Control plane <span class="o">(</span>master<span class="o">)</span> label and taint were applied to the new node.
<span class="k">*</span> The Kubernetes control plane instances scaled up.
<span class="k">*</span> A new etcd member was added to the <span class="nb">local</span>/stacked etcd cluster.

To start administering your cluster from this node, you need to run the following as a regular user:

<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$HOME</span>/.kube
<span class="nb">sudo cp</span> <span class="nt">-i</span> /etc/kubernetes/admin.conf <span class="nv">$HOME</span>/.kube/config
<span class="nb">sudo chown</span> <span class="si">$(</span><span class="nb">id</span> <span class="nt">-u</span><span class="si">)</span>:<span class="si">$(</span><span class="nb">id</span> <span class="nt">-g</span><span class="si">)</span> <span class="nv">$HOME</span>/.kube/config

Run <span class="s1">'kubectl get nodes'</span> to see this node <span class="nb">join </span>the cluster.

<span class="c"># config file 복사</span>
ps0107@k8smaster2:~<span class="nv">$ </span><span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$HOME</span>/.kube                                                                                             
ps0107@k8smaster2:~<span class="nv">$ </span><span class="nb">sudo cp</span> <span class="nt">-i</span> /etc/kubernetes/admin.conf <span class="nv">$HOME</span>/.kube/config
ps0107@k8smaster2:~<span class="nv">$ </span><span class="nb">sudo chown</span> <span class="si">$(</span><span class="nb">id</span> <span class="nt">-u</span><span class="si">)</span>:<span class="si">$(</span><span class="nb">id</span> <span class="nt">-g</span><span class="si">)</span> <span class="nv">$HOME</span>/.kube/config

<span class="c"># master 1번에서 node 리스트를 확인해보자.</span>
<span class="c"># 정상적으로 2번 마스트노드가 조인된걸 확인할수 있다. 3번도 같은 방법으로 수행한다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl get nodes
NAME         STATUS   ROLES    AGE     VERSION
k8smaster1   Ready    master   21d     v1.15.1
k8smaster2   Ready    master   4m15s   v1.15.1
k8sworker1   Ready    &lt;none&gt;   21d     v1.15.1

<span class="c"># etcd pod도 조회해본다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> kube-system get pods | <span class="nb">grep </span>etcd
etcd-k8smaster1                      1/1     Running   0          21d
etcd-k8smaster2                      1/1     Running   0          117m

<span class="c"># 새로 생긴 etcd pod의 로그를 확인해 본다. </span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> kube-system logs <span class="nt">-f</span> etcd-k8smaster2 
......
2020-02-19 03:28:08.167787 I | etcdserver: start to snapshot <span class="o">(</span>applied: 2930857, lastsnap: 2920856<span class="o">)</span>
2020-02-19 03:28:08.173395 I | etcdserver: saved snapshot at index 2930857
2020-02-19 03:28:08.174123 I | etcdserver: compacted raft log at 2925857
2020-02-19 03:30:02.972421 I | mvcc: store.index: compact 2528020
2020-02-19 03:30:02.973830 I | mvcc: finished scheduled compaction at 2528020 <span class="o">(</span>took 1.034404ms<span class="o">)</span>

<span class="c"># etcd pod에 들어가서 cluster status를 체크해보자.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> kube-system  <span class="nb">exec</span> <span class="nt">-it</span> etcd-k8smaster1 <span class="nt">--</span> /bin/sh

<span class="c"># 아래 명령으로 조회해 본다.</span>
<span class="c"># master1 etcd 가 리더로 설정되어 있다.</span>
<span class="nv">ETCDCTL_API</span><span class="o">=</span>3 etcdctl <span class="nt">-w</span> table ￦
<span class="nt">--endpoints</span> 10.146.0.2:2379,10.146.0.13:2379 ￦
<span class="nt">--cacert</span> /etc/kubernetes/pki/etcd/ca.crt ￦
<span class="nt">--cert</span> /etc/kubernetes/pki/etcd/server.crt ￦
<span class="nt">--key</span> /etc/kubernetes/pki/etcd/server.key ￦
endpoint status

+------------------+------------------+---------+---------+-----------+-----------+------------+
|     ENDPOINT     |        ID        | VERSION | DB SIZE | IS LEADER | RAFT TERM | RAFT INDEX |
+------------------+------------------+---------+---------+-----------+-----------+------------+
|  10.146.0.2:2379 | 7a2c7e572714edd4 |  3.3.10 |  5.3 MB |      <span class="nb">true</span> |         6 |    2936615 |
| 10.146.0.13:2379 | fb2d7152d16646c3 |  3.3.10 |  5.3 MB |     <span class="nb">false</span> |         6 |    2936615 |
+------------------+------------------+---------+---------+-----------+-----------+------------+
</pre></table></code></div></div><ul><li>윽.. gcp 사용중인데 한 리즌에 cpu 리밋이 8개라 더이상 인스턴스 생성이 불가하네요~<li>일단 그냥 한대 master 붙인걸로 테스트 해봐야겠네요.<li>http://35.243.70.115:9999/stats 접속하여 정상 적으로 분배되어 들어가는지 확인한다.</ul><p><img data-proofer-ignore data-src="/assets/images/kubernetes/kubernetes-administration/ha2.jpg" alt="ha" /></p><p>현재 노드한개가 추가된 걸 볼수 있다.</p><hr /><h2 id="failover-테스트-해보자">FailOver 테스트 해보자.</h2><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre><td class="rouge-code"><pre><span class="c">###############################################</span>
<span class="c"># FailOver 테스트 해보자.</span>
<span class="c">###############################################</span>

<span class="c"># master 1번 서버에서 docker service를 내려보자.</span>
ps0107@k8smaster1:~<span class="nv">$ </span><span class="nb">sudo </span>service docker stop

<span class="c"># etcd 로그를 확인해보자.</span>
<span class="c"># master1번 etcd 에 대한 connection을 잃었다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> kube-system logs <span class="nt">-f</span> etcd-k8smaster2
.....
2020-02-19 04:20:17.075534 I | raft: fb2d7152d16646c3 became leader at term 7
2020-02-19 04:20:17.075554 I | raft: raft.node: fb2d7152d16646c3 elected leader fb2d7152d16646c3 at term 7
2020-02-19 04:20:17.170081 W | rafthttp: lost the TCP streaming connection with peer 7a2c7e572714edd4 <span class="o">(</span>stream Message reader<span class="o">)</span>
2020-02-19 04:20:17.170267 W | rafthttp: lost the TCP streaming connection with peer 7a2c7e572714edd4 <span class="o">(</span>stream MsgApp v2 reader<span class="o">)</span>
2020-02-19 04:20:17.192833 E | rafthttp: failed to dial 7a2c7e572714edd4 on stream Message <span class="o">(</span>EOF<span class="o">)</span>
2020-02-19 04:20:17.192864 I | rafthttp: peer 7a2c7e572714edd4 became inactive <span class="o">(</span>message send to peer failed<span class="o">)</span>
2020-02-19 04:20:17.454474 W | rafthttp: lost the TCP streaming connection with peer 7a2c7e572714edd4 <span class="o">(</span>stream Message writer<span class="o">)</span>
2020-02-19 04:20:19.054260 W | raft: fb2d7152d16646c3 stepped down to follower since quorum is not active

<span class="c"># kubectl 명령은 잘 수행된다.</span>
<span class="c"># master1번이 not ready 상태로 변경되었다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl get nodes
NAME         STATUS     ROLES    AGE    VERSION
k8smaster1   NotReady   master   21d    v1.15.1
k8smaster2   Ready      master   138m   v1.15.1
k8sworker1   NotReady   &lt;none&gt;   21d    v1.15.1

<span class="c"># etcd를 접속해 cluster 상태를 확인해본다.</span>
<span class="c"># 리더가 master2 etcd로 변경되었다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> kube-system  <span class="nb">exec</span> <span class="nt">-it</span> etcd-k8smaster2 <span class="nt">--</span> /bin/sh

<span class="nv">ETCDCTL_API</span><span class="o">=</span>3 etcdctl <span class="nt">-w</span> table ￦
<span class="nt">--endpoints</span> 10.146.0.2:2379,10.146.0.13:2379 ￦
<span class="nt">--cacert</span> /etc/kubernetes/pki/etcd/ca.crt ￦
<span class="nt">--cert</span> /etc/kubernetes/pki/etcd/server.crt ￦
<span class="nt">--key</span> /etc/kubernetes/pki/etcd/server.key ￦
endpoint status

+------------------+------------------+---------+---------+-----------+-----------+------------+
|     ENDPOINT     |        ID        | VERSION | DB SIZE | IS LEADER | RAFT TERM | RAFT INDEX |
+------------------+------------------+---------+---------+-----------+-----------+------------+
|  10.146.0.2:2379 | 7a2c7e572714edd4 |  3.3.10 |  5.3 MB |     <span class="nb">false</span> |        10 |    2937708 |
| 10.146.0.13:2379 | fb2d7152d16646c3 |  3.3.10 |  5.3 MB |      <span class="nb">true</span> |        10 |    2937708 |
+------------------+------------------+---------+---------+-----------+-----------+------------+
</pre></table></code></div></div><ul><li>http://35.243.70.115:9999/stats 접속하여 노드 상태를 확인할 수 있다.</ul><p><img data-proofer-ignore data-src="/assets/images/kubernetes/kubernetes-administration/ha3.jpg" alt="ha" /></p><ul><li>노드상태를 볼수 있다. docker service를 내린 후 fail 상태를 볼수 있다.</ul><hr /><h2 id="이제-다시-master1번-노드를-정상화-하여-본다">이제 다시 master1번 노드를 정상화 하여 본다.</h2><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="c"># 이제 다시 master1번 서버의 docker service를 시작해 보자.</span>
ps0107@k8smaster1:~<span class="nv">$ </span><span class="nb">sudo </span>service docker start  

<span class="c"># 정상적으로 Ready 상태로 변경되었다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl get node
NAME         STATUS   ROLES    AGE    VERSION
k8smaster1   Ready    master   21d    v1.15.1
k8smaster2   Ready    master   142m   v1.15.1
k8sworker1   Ready    &lt;none&gt;   21d    v1.15.1

http://35.243.70.115:9999/stats 접속하여 노드 상태를 확인할 수 있다.

<span class="c"># etcd 로그르 확인해보자.</span>
<span class="c"># master1번 etcd가 active 되었음을 확인할 수 있다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> kube-system logs <span class="nt">-f</span> etcd-k8smaster2
.....
2020-02-19 04:27:41.728243 I | rafthttp: peer 7a2c7e572714edd4 became active
2020-02-19 04:27:41.728282 I | rafthttp: established a TCP streaming connection with peer 7a2c7e572714edd4 <span class="o">(</span>stream MsgApp v2 reader<span class="o">)</span>
2020-02-19 04:27:41.729772 I | rafthttp: established a TCP streaming connection with peer 7a2c7e572714edd4 <span class="o">(</span>stream Message reader<span class="o">)</span>
2020-02-19 04:27:41.741347 W | rafthttp: closed an existing TCP streaming connection with peer 7a2c7e572714edd4 <span class="o">(</span>stream MsgApp v2 writer<span class="o">)</span>
.....
</pre></table></code></div></div><ul><li>http://35.243.70.115:9999/stats 접속하여 노드 상태를 확인할 수 있다.</ul><p><img data-proofer-ignore data-src="/assets/images/kubernetes/kubernetes-administration/ha4.jpg" alt="ha" /></p><p>두개 노드다 정상화 된것을 확인할 수 있다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/kubernetes/'>Kubernetes</a>, <a href='/categories/kubernetes-administration-course/'>Kubernetes Administration Course</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >kubernetes</a> <a href="/tags/cka/" class="post-tag no-text-decoration" >cka</a> <a href="/tags/lfs458/" class="post-tag no-text-decoration" >LFS458</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[kubernetes-실습] HA(High Availability) 구성 - master node - ps's Blog&url=https://ps2046.github.io/posts/24.kubernetes_HA/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[kubernetes-실습] HA(High Availability) 구성 - master node - ps's Blog&u=https://ps2046.github.io/posts/24.kubernetes_HA/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=[kubernetes-실습] HA(High Availability) 구성 - master node - ps's Blog&url=https://ps2046.github.io/posts/24.kubernetes_HA/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/blog-comments-utterances/">[blog] github blog comments (utterances)</a><li><a href="/posts/17.kubernetes_Scheduling_2/">[kubernetes-실습] Scheduling - Taint를 이용한 pod 배포 관리</a><li><a href="/posts/18.kubernetes_logging_trubleshooting_1/">[kubernetes-실습] 로깅과 트러블슈팅 : 로그위치와 로그 출력 보기</a><li><a href="/posts/19.kubernetes_logging_trubleshooting_2/">[kubernetes-실습] 로깅과 트러블슈팅 : Metrics와 DashBoard</a><li><a href="/posts/20.kubernetes_crd/">[kubernetes-실습] CRD (Custom Resource Definition)</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cka/">cka</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/lfs458/">LFS458</a> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/comments/">comments</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/monitoring/">monitoring</a> <a class="post-tag" href="/tags/system/">system</a> <a class="post-tag" href="/tags/utterances/">utterances</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/17.kubernetes_Scheduling_2/"><div class="card-body"> <span class="timeago small" >Jan 26<i class="unloaded">2021-01-26T08:30:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[kubernetes-실습] Scheduling - Taint를 이용한 pod 배포 관리</h3><div class="text-muted small"><p> Using Taints to Control Pod Deployment taints를 사용하여 어느곳에 pod가 배치되거나 실행을 허용하도록 관리할수 있다. 노드 그룹에 pod들을 할당하여 추가할때 노드 사용을 제한하거나 pod들을 완전히 대피시킬수 있다. 참고 마스터노드가 처음에 NoSchedule taint로 설정되어 있었던것을 기억할 것이다...</p></div></div></a></div><div class="card"> <a href="/posts/18.kubernetes_logging_trubleshooting_1/"><div class="card-body"> <span class="timeago small" >Jan 26<i class="unloaded">2021-01-26T09:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[kubernetes-실습] 로깅과 트러블슈팅 : 로그위치와 로그 출력 보기</h3><div class="text-muted small"><p> 로그 파일들의 위치 알아보기 다양한 로그 파일과 명령 출력 이외에도 journalctl을 사용하여 노드 관점에서 로그를 볼 수 있다. 우리는 로그 파일의 공통적인 위치를 보고, 컨테이너 로그를 보는 명령을 볼 것이다. 다른 컨테이너의 로그를 pod에 적재하는데 전용으로 사용되는 sidecar container의 사용과 같은 다른 로깅 ...</p></div></div></a></div><div class="card"> <a href="/posts/19.kubernetes_logging_trubleshooting_2/"><div class="card-body"> <span class="timeago small" >Jan 26<i class="unloaded">2021-01-26T10:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[kubernetes-실습] 로깅과 트러블슈팅 : Metrics와 DashBoard</h3><div class="text-muted small"><p> Metrics 설정 heapster가 deprecation 되면서 Metrics Server 와 통합되어 개발되고 배포되어지고 있다. 그리고 CNCF의 프로젝트중 프로메테우스도 잘 사용되어지고 있다. # --------------------------------- # Metrics 설정 # ----------------------------...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/23.kubernetes_Security_Authentication_Authorization_Admission/" class="btn btn-outline-primary" prompt="Older"><p>[kubernetes-실습] Security - Authentication, Authorization, Admission</p></a> <a href="/posts/00.linux_system_analysis/" class="btn btn-outline-primary" prompt="Newer"><p>[linux] 시스템 성능 분석 관련 명령어</p></a></div><script src="https://utteranc.es/client.js" repo="ps2046/ps2046-github-io-comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async> </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://ps2046.github.io">ps.jang</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/cka/">cka</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/lfs458/">LFS458</a> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/comments/">comments</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/monitoring/">monitoring</a> <a class="post-tag" href="/tags/system/">system</a> <a class="post-tag" href="/tags/utterances/">utterances</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://ps2046.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-158837927-2"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-158837927-2'); }); </script>
