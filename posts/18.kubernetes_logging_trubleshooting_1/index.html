<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="[kubernetes-실습] 로깅과 트러블슈팅 : 로그위치와 로그 출력 보기" /><meta property="og:locale" content="en" /><meta name="description" content="kubernetes 인증 시험(CKA)에 대비하기 위해 실습을 해보도록 한다." /><meta property="og:description" content="kubernetes 인증 시험(CKA)에 대비하기 위해 실습을 해보도록 한다." /><link rel="canonical" href="https://ps2046.github.io/posts/18.kubernetes_logging_trubleshooting_1/" /><meta property="og:url" content="https://ps2046.github.io/posts/18.kubernetes_logging_trubleshooting_1/" /><meta property="og:site_name" content="ps’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-01-26T09:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[kubernetes-실습] 로깅과 트러블슈팅 : 로그위치와 로그 출력 보기" /><meta name="twitter:site" content="@ps2046" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"kubernetes 인증 시험(CKA)에 대비하기 위해 실습을 해보도록 한다.","headline":"[kubernetes-실습] 로깅과 트러블슈팅 : 로그위치와 로그 출력 보기","dateModified":"2021-08-26T00:00:00+09:00","url":"https://ps2046.github.io/posts/18.kubernetes_logging_trubleshooting_1/","datePublished":"2021-01-26T09:00:00+09:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://ps2046.github.io/posts/18.kubernetes_logging_trubleshooting_1/"},"@context":"https://schema.org"}</script><title>[kubernetes-실습] 로깅과 트러블슈팅 : 로그위치와 로그 출력 보기 | ps's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ps's Blog"><meta name="application-name" content="ps's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7635228999568716" crossorigin="anonymous"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/11029548?s=400&u=5ebc191faa53e931968ec2ed98bd7c7b68136c71&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">ps's Blog</a></div><div class="site-subtitle font-italic">System Engineer & Developer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/ps2046" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/ps2046" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ps2046.jang','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[kubernetes-실습] 로깅과 트러블슈팅 : 로그위치와 로그 출력 보기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[kubernetes-실습] 로깅과 트러블슈팅 : 로그위치와 로그 출력 보기</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> ps.jang </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Jan 26, 2021, 9:00 AM +0900" >Jan 26<i class="unloaded">2021-01-26T09:00:00+09:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, Aug 26, 2021, 12:00 AM +0000" >Aug 26<i class="unloaded">2021-08-26T00:00:00+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1488 words">8 min read</span></div></div><div class="post-content"><h2 id="로그-파일들의-위치-알아보기">로그 파일들의 위치 알아보기</h2><ul><li><p>다양한 로그 파일과 명령 출력 이외에도 journalctl을 사용하여 노드 관점에서 로그를 볼 수 있다. 우리는 로그 파일의 공통적인 위치를 보고, 컨테이너 로그를 보는 명령을 볼 것이다. 다른 컨테이너의 로그를 pod에 적재하는데 전용으로 사용되는 sidecar container의 사용과 같은 다른 로깅 옵션이 있다. Kubernet에서 전체 클러스터 로깅을 아직 사용할 수 없다. 따라서 kubernetes 같이 CNCF 프로젝트 다른 멤버인 fluentd 같은 외부 software를 사용된다.</p><li><p>다음의 로그 파일과 웹 사이트를 간단히 살펴보십시오. 서버 프로세스가 노드 수준에서 컨테이너안에 실행으로 이동함에 따라 로깅도 이동한다.</p></ul><h3 id="journalctl-명령-사용-kubernetes-cluster가-systemd를-사용할때만-가능">journalctl 명령 사용 (kubernetes cluster가 systemd를 사용할때만 가능)</h3><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c"># -------------------------------------</span>
<span class="c"># journalctl 명령 사용 (kubernetes cluster가 systemd를 사용할때만 가능)</span>
<span class="c"># -------------------------------------</span>
<span class="c"># journalctl 명령 : systemd 로그가 journal로 관리되는데 이런 journal들을 조회할 때 쓰임.</span>
<span class="c"># journalctl &lt;tab x 2&gt; 참조</span>
<span class="c"># journalctl 옵션</span>
<span class="c"># -u : 특정 unit 로그 확인</span>
<span class="c"># -f : 실시간으로 로그 확인</span>
<span class="c"># https://wiki.archlinux.org/index.php/Systemd/Journal</span>

ps0107@k8smaster1:~<span class="nv">$ </span><span class="nb">sudo </span>journalctl <span class="nt">-u</span> kubelet | <span class="nb">tail</span> <span class="nt">-5</span>                                                                            
Feb 05 02:10:19 k8smaster1 kubelet[5279]: I0205 02:10:19.268859    5279 reconciler.go:177] operationExecutor.UnmountVolume started <span class="k">for </span>volume <span class="s2">"default-token-76w5h"</span> <span class="o">(</span>UniqueName: <span class="s2">"kubernetes.io/secret/ccc2b1fb-ffd4-4078-9bd2-b63e662e2ef4-default-token-76w5h"</span><span class="o">)</span> pod <span class="s2">"ccc2b1fb-ffd4-4078-9bd2-b63e662e2ef4"</span> <span class="o">(</span>UID: <span class="s2">"ccc2b1fb-ffd4-4078-9bd2-b63e662e2ef4"</span><span class="o">)</span>
Feb 05 02:10:19 k8smaster1 kubelet[5279]: I0205 02:10:19.282026    5279 operation_generator.go:860] UnmountVolume.TearDown succeeded <span class="k">for </span>volume <span class="s2">"kubernetes.io/secret/24257df3-fa70-47ba-b02f-8bbf5da263dd-default-token-76w5h"</span> <span class="o">(</span>OuterVolumeSpecName: <span class="s2">"default-token-76w5h"</span><span class="o">)</span> pod <span class="s2">"24257df3-fa70-47ba-b02f-8bbf5da263dd"</span> <span class="o">(</span>UID: <span class="s2">"24257df3-fa70-47ba-b02f-8bbf5da263dd"</span><span class="o">)</span><span class="nb">.</span> InnerVolumeSpecName <span class="s2">"default-token-76w5h"</span><span class="nb">.</span> PluginName <span class="s2">"kubernetes.io/secret"</span>, VolumeGidValue <span class="s2">""</span>
....
</pre></table></code></div></div><h3 id="노드-podcontainer-로그">노드 pod/container 로그</h3><ul><li>/var/log/containers/ : 여러 container 로그들<li>/var/log/pods/ : 현재 pod들을 위한 로그 파일들</ul><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
</pre><td class="rouge-code"><pre><span class="c"># -------------------------------------</span>
<span class="c"># 노드 pod/container 로그</span>
<span class="c"># -------------------------------------</span>
<span class="c"># /var/log/containers/ : 여러 container 로그들</span>
<span class="c"># /var/log/pods/ : 현재 pod들을 위한 로그 파일들</span>

<span class="c"># 주요 쿠버네티스 프로세스들은 컨테이너로 실행된다. pod 또는 container 관점으로 볼수 있다.</span>
<span class="c"># 해당 로그가 어디에 위치하고 있는지 보면 /var/log/containers/ 의 컨테이너 로그는 /var/log/pods/ 안에 로그에 심볼릭링크가 걸려있다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span><span class="nb">sudo  </span>find / <span class="nt">-name</span> <span class="s2">"*apiserver*log"</span>
/var/log/containers/kube-apiserver-k8smaster1_kube-system_kube-apiserver-20ee76df3202cd45c43568d04f2c6350c33cf02e082aff03331863c75b9c2e9f.log

ps0107@k8smaster1:~<span class="nv">$ </span><span class="nb">sudo tail</span> /var/log/containers/kube-apiserver-k8smaster1_kube-system_kube-apiserver-20ee76df3202cd45c43568d04f2c6350c33cf02e082aff03331863c75b9c2e9f.log
<span class="o">{</span><span class="s2">"log"</span>:<span class="s2">"Trace[758496088]: [1.54222154s] [1.541983765s] Transaction committed</span><span class="se">\n</span><span class="s2">"</span>,<span class="s2">"stream"</span>:<span class="s2">"stderr"</span>,<span class="s2">"time"</span>:<span class="s2">"2020-01-30T05:16:34.841260969Z"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"log"</span>:<span class="s2">"I0130 05:16:34.824687       1 trace.go:81] Trace[1004905485]: </span><span class="se">\"</span><span class="s2">Update /api/v1/namespaces/kube-system/endpoints/kube-controller-manager</span><span class="se">\"</span><span class="s2"> (started: 2020-01-30 05:16:33.282084781 +0000 UTC m=+161232.462995704) (total time: 1.542580238s):</span><span class="se">\n</span><span class="s2">"</span>,<span class="s2">"stream"</span>:<span class="s2">"stderr"</span>,<span class="s2">"time"</span>:<span class="s2">"2020-01-30T05:16:34.841266335Z"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"log"</span>:<span class="s2">"Trace[1004905485]: [1.542484521s] [1.542396457s] Object stored in database</span><span class="se">\n</span><span class="s2">"</span>,<span class="s2">"stream"</span>:<span class="s2">"stderr"</span>,<span class="s2">"time"</span>:<span class="s2">"2020-01-30T05:16:34.841281926Z"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"log"</span>:<span class="s2">"I0130 12:43:57.718791       1 log.go:172] http: TLS handshake error from 163.172.16.99:2332: tls: first record does not look like a TLS handshake</span><span class="se">\n</span><span class="s2">"</span>,<span class="s2">"stream"</span>:<span class="s2">"stderr"</span>,<span class="s2">"time"</span>:<span class="s2">"2020-01-30T12:43:57.718994903Z"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"log"</span>:<span class="s2">"I0202 14:09:21.314630       1 controller.go:606] quota admission added evaluator for: jobs.batch</span><span class="se">\n</span><span class="s2">"</span>,<span class="s2">"stream"</span>:<span class="s2">"stderr"</span>,<span class="s2">"time"</span>:<span class="s2">"2020-02-02T14:09:21.314861538Z"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"log"</span>:<span class="s2">"I0202 14:56:06.400851       1 controller.go:606] quota admission added evaluator for: cronjobs.batch</span><span class="se">\n</span><span class="s2">"</span>,<span class="s2">"stream"</span>:<span class="s2">"stderr"</span>,<span class="s2">"time"</span>:<span class="s2">"2020-02-02T14:56:06.401042597Z"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"log"</span>:<span class="s2">"I0203 01:17:35.531438       1 controller.go:606] quota admission added evaluator for: replicasets.extensions</span><span class="se">\n</span><span class="s2">"</span>,<span class="s2">"stream"</span>:<span class="s2">"stderr"</span>,<span class="s2">"time"</span>:<span class="s2">"2020-02-03T01:17:35.531608401Z"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"log"</span>:<span class="s2">"I0203 14:48:02.892069       1 log.go:172] http: TLS handshake error from 198.108.67.48:44142: read tcp 10.146.0.2:6443-</span><span class="se">\u</span><span class="s2">003e198.108.67.48:44142: read: connection reset by peer</span><span class="se">\n</span><span class="s2">"</span>,<span class="s2">"stream"</span>:<span class="s2">"stderr"</span>,<span class="s2">"time"</span>:<span class="s2">"2020-02-03T14:48:02.892238145Z"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"log"</span>:<span class="s2">"I0204 02:03:55.599499       1 log.go:172] http: TLS handshake error from 198.108.67.48:19574: read tcp 10.146.0.2:6443-</span><span class="se">\u</span><span class="s2">003e198.108.67.48:19574: read: connection reset by peer</span><span class="se">\n</span><span class="s2">"</span>,<span class="s2">"stream"</span>:<span class="s2">"stderr"</span>,<span class="s2">"time"</span>:<span class="s2">"2020-02-04T02:03:55.599677119Z"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"log"</span>:<span class="s2">"I0204 08:28:48.956703       1 controller.go:606] quota admission added evaluator for: ingresses.extensions</span><span class="se">\n</span><span class="s2">"</span>,<span class="s2">"stream"</span>:<span class="s2">"stderr"</span>,<span class="s2">"time"</span>:<span class="s2">"2020-02-04T08:28:48.956873937Z"</span><span class="o">}</span>

ps0107@k8smaster1:/var/log/containers<span class="nv">$ </span><span class="nb">ls
</span>calico-node-wvxxm_kube-system_calico-node-d2879a40b389a1ef99359af7356ea1efcea497352d96f1e665729f783fdd92b7.log
calico-node-wvxxm_kube-system_install-cni-8e9c02311deebb50195a5f4333b2ba89646cc5799b5542d95f23612018468636.log
coredns-5c98db65d4-97gng_kube-system_coredns-6d822d735d3bb02dd4171294438f9bed5a8ed44821bbadb843cb9422a465c6b4.log
coredns-5c98db65d4-fvz2k_kube-system_coredns-5b255b61a93ed2fe9d3209e8135b3a54824af73690462af0c08a6f4ed55c7148.log
etcd-k8smaster1_kube-system_etcd-3147aa1dc7e6bcf0677e875000730db51b45c1f4e25458077fd921d333829122.log
kube-apiserver-k8smaster1_kube-system_kube-apiserver-20ee76df3202cd45c43568d04f2c6350c33cf02e082aff03331863c75b9c2e9f.log
kube-controller-manager-k8smaster1_kube-system_kube-controller-manager-156da4c1dc59e7144455a2014746da903421de5d7b2120874c069800cbfac717.log                                                                                                                               kube-proxy-t62q4_kube-system_kube-proxy-a6f991ba816b7927cb26cc6016fa45f98d87a0b630d7c897315edc4ed5038df9.log
kube-scheduler-k8smaster1_kube-system_kube-scheduler-7649252338f03b870c74e33731a2f8b162db7b981488d2ccadc1072903ede7d8.log
traefik-ingress-controller-jdvck_kube-system_traefik-ingress-lb-e757ed51250e22dc8977f9ed7b0d26352c57fc4961232e955e80bef14af85ab6.log

ps0107@k8smaster1:/var/log/pods<span class="nv">$ </span>ll
total 44
drwxr-xr-x 11 root root   4096 Feb  5 02:10 ./
drwxrwxr-x 10 root syslog 4096 Feb  4 06:25 ../
drwxr-xr-x  4 root root   4096 Jan 28 08:33 kube-system_calico-node-wvxxm_9cff8584-8fa3-493b-a01e-0567c6cd11f2/
drwxr-xr-x  3 root root   4096 Jan 28 08:33 kube-system_coredns-5c98db65d4-97gng_9e2cfd14-4a08-4703-a7e8-d4c85f7878a1/
drwxr-xr-x  3 root root   4096 Jan 28 08:33 kube-system_coredns-5c98db65d4-fvz2k_a4208d56-10d2-4958-b345-01603d5aa57b/
drwxr-xr-x  3 root root   4096 Dec  5 16:19 kube-system_etcd-k8smaster1_92c04c96b41833d6edb6666054fd741f/
drwxr-xr-x  3 root root   4096 Jan 28 08:29 kube-system_kube-apiserver-k8smaster1_214ef7c9b4c2389fde69afa9327c7a33/
drwxr-xr-x  3 root root   4096 Jan 28 08:29 kube-system_kube-controller-manager-k8smaster1_645e7a8519364c082c136bba3c26849b/
drwxr-xr-x  3 root root   4096 Jan 28 08:29 kube-system_kube-proxy-t62q4_3b2fe619-eca0-4356-8ff3-7ef781935d19/
drwxr-xr-x  3 root root   4096 Jan 28 08:29 kube-system_kube-scheduler-k8smaster1_ecae9d12d3610192347be3d1aa5aa552/
drwxr-xr-x  3 root root   4096 Feb  4 08:47 kube-system_traefik-ingress-controller-jdvck_c79ea85c-07b0-4277-939b-9e27d9422159/

<span class="c"># 위에서 조회한 /var/log/containers/ 안에 있는 로그와 같다. /var/log/pods/ 안에 있는 해당 로그가 symbolic link 걸려 있다.</span>
ps0107@k8smaster1:/var/log/pods/kube-system_kube-apiserver-k8smaster1_214ef7c9b4c2389fde69afa9327c7a33/kube-apiserver<span class="nv">$ </span><span class="nb">sudo tail </span>0.log 
<span class="o">{</span><span class="s2">"log"</span>:<span class="s2">"Trace[758496088]: [1.54222154s] [1.541983765s] Transaction committed</span><span class="se">\n</span><span class="s2">"</span>,<span class="s2">"stream"</span>:<span class="s2">"stderr"</span>,<span class="s2">"time"</span>:<span class="s2">"2020-01-30T05:16:34.841260969Z"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"log"</span>:<span class="s2">"I0130 05:16:34.824687       1 trace.go:81] Trace[1004905485]: </span><span class="se">\"</span><span class="s2">Update /api/v1/namespaces/kube-system/endpoints/kube-controller-manager</span><span class="se">\"</span><span class="s2"> (started: 2020-01-30 05:16:33.282084781 +0000 UTC m=+161232.462995704) (total time: 1.542580238s):</span><span class="se">\n</span><span class="s2">"</span>,<span class="s2">"stream"</span>:<span class="s2">"stderr"</span>,<span class="s2">"time"</span>:<span class="s2">"2020-01-30T05:16:34.841266335Z"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"log"</span>:<span class="s2">"Trace[1004905485]: [1.542484521s] [1.542396457s] Object stored in database</span><span class="se">\n</span><span class="s2">"</span>,<span class="s2">"stream"</span>:<span class="s2">"stderr"</span>,<span class="s2">"time"</span>:<span class="s2">"2020-01-30T05:16:34.841281926Z"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"log"</span>:<span class="s2">"I0130 12:43:57.718791       1 log.go:172] http: TLS handshake error from 163.172.16.99:2332: tls: first record does not look like a TLS handshake</span><span class="se">\n</span><span class="s2">"</span>,<span class="s2">"stream"</span>:<span class="s2">"stderr"</span>,<span class="s2">"time"</span>:<span class="s2">"2020-01-30T12:43:57.718994903Z"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"log"</span>:<span class="s2">"I0202 14:09:21.314630       1 controller.go:606] quota admission added evaluator for: jobs.batch</span><span class="se">\n</span><span class="s2">"</span>,<span class="s2">"stream"</span>:<span class="s2">"stderr"</span>,<span class="s2">"time"</span>:<span class="s2">"2020-02-02T14:09:21.314861538Z"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"log"</span>:<span class="s2">"I0202 14:56:06.400851       1 controller.go:606] quota admission added evaluator for: cronjobs.batch</span><span class="se">\n</span><span class="s2">"</span>,<span class="s2">"stream"</span>:<span class="s2">"stderr"</span>,<span class="s2">"time"</span>:<span class="s2">"2020-02-02T14:56:06.401042597Z"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"log"</span>:<span class="s2">"I0203 01:17:35.531438       1 controller.go:606] quota admission added evaluator for: replicasets.extensions</span><span class="se">\n</span><span class="s2">"</span>,<span class="s2">"stream"</span>:<span class="s2">"stderr"</span>,<span class="s2">"time"</span>:<span class="s2">"2020-02-03T01:17:35.531608401Z"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"log"</span>:<span class="s2">"I0203 14:48:02.892069       1 log.go:172] http: TLS handshake error from 198.108.67.48:44142: read tcp 10.146.0.2:6443-</span><span class="se">\u</span><span class="s2">003e198.108.67.48:44142: read: connection reset by peer</span><span class="se">\n</span><span class="s2">"</span>,<span class="s2">"stream"</span>:<span class="s2">"stderr"</span>,<span class="s2">"time"</span>:<span class="s2">"2020-02-03T14:48:02.892238145Z"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"log"</span>:<span class="s2">"I0204 02:03:55.599499       1 log.go:172] http: TLS handshake error from 198.108.67.48:19574: read tcp 10.146.0.2:6443-</span><span class="se">\u</span><span class="s2">003e198.108.67.48:19574: read: connection reset by peer</span><span class="se">\n</span><span class="s2">"</span>,<span class="s2">"stream"</span>:<span class="s2">"stderr"</span>,<span class="s2">"time"</span>:<span class="s2">"2020-02-04T02:03:55.599677119Z"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"log"</span>:<span class="s2">"I0204 08:28:48.956703       1 controller.go:606] quota admission added evaluator for: ingresses.extensions</span><span class="se">\n</span><span class="s2">"</span>,<span class="s2">"stream"</span>:<span class="s2">"stderr"</span>,<span class="s2">"time"</span>:<span class="s2">"2020-02-04T08:28:48.956873937Z"</span><span class="o">}</span>

<span class="c"># kube-dns, kube-proxy, kube-flannel 등도 이런 식으로 조회해 볼수 있다.</span>
</pre></table></code></div></div><hr /><h2 id="kubernetes-cluster가-systemd를-사용하지-않을때">kubernetes cluster가 systemd를 사용하지 않을때</h2><h3 id="master-node에서-확인">master node에서 확인</h3><ul><li>/var/log/kube-apiserver.log =&gt; API 받는 응답을 볼수 있다.<li>/var/log/kube-scheduler.log =&gt; 스케쥴링 결정을 만드는 응답을 볼수 있다.<li>/var/log/kube-controller-manager.log =&gt; controller 관련 로그를 볼수 있다.</ul><h3 id="worker-node에서-확인">worker node에서 확인</h3><ul><li>/var/log/kubelet.log =&gt; 노드에 실행 중인 컨테이너들의 응답을 볼수 있다<li>/var/log/kube-proxy.log =&gt; service load balancing 관련 로그들</ul><hr /><h2 id="그밖에-도움이-되는-웹페이지">그밖에 도움이 되는 웹페이지</h2><ul><li>https://kubernetes.io/docs/tasks/debug-application-cluster/\debug-service/<li>https://kubernetes.io/docs/tasks/debug-application-cluster/\determine-reason-pod-failure/</ul><hr /><h2 id="로그들-출력-보기">로그들 출력 보기</h2><ul><li>컨테이너 standard out 로그는 kubectl logs 명령을 통해서 볼수 있다. 해당 컨테이너가 삭제되면 로그들도 삭제 된다.</ul><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="c"># 컨테이너 standard out 로그는 kubectl logs 명령을 통해서 볼수 있다. 해당 컨테이너가 삭제되면 로그들도 삭제 된다.</span>
<span class="c"># 현재 pod들 목록 보기</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl get po <span class="nt">--all-namespaces</span>
NAMESPACE     NAME                                 READY   STATUS    RESTARTS   AGE
kube-system   calico-node-wvxxm                    2/2     Running   0          7d22h
kube-system   calico-node-zxkxk                    2/2     Running   2          7d22h
kube-system   coredns-5c98db65d4-97gng             1/1     Running   0          7d22h
kube-system   coredns-5c98db65d4-fvz2k             1/1     Running   0          7d22h
kube-system   etcd-k8smaster1                      1/1     Running   0          7d22h
kube-system   kube-apiserver-k8smaster1            1/1     Running   0          7d22h
kube-system   kube-controller-manager-k8smaster1   1/1     Running   0          7d22h
kube-system   kube-proxy-t62q4                     1/1     Running   0          7d22h
kube-system   kube-proxy-tnmtr                     1/1     Running   1          7d22h
kube-system   kube-scheduler-k8smaster1            1/1     Running   0          7d22h
kube-system   traefik-ingress-controller-8884w     1/1     Running   0          5h11m
kube-system   traefik-ingress-controller-jdvck     1/1     Running   0          22h

<span class="c"># 탭 2번하면 목록을 볼수 있다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> kube-system logs &lt;tab x 2&gt;
calico-node-wvxxm                   etcd-k8smaster1                     kube-proxy-tnmtr
calico-node-zxkxk                   kube-apiserver-k8smaster1           kube-scheduler-k8smaster1
coredns-5c98db65d4-97gng            kube-controller-manager-k8smaster1  traefik-ingress-controller-8884w
coredns-5c98db65d4-fvz2k            kube-proxy-t62q4                    traefik-ingress-controller-jdvck

ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> kube-system logs kube-apiserver-k8smaster1 
Flag <span class="nt">--insecure-port</span> has been deprecated, This flag will be removed <span class="k">in </span>a future version.
I0128 08:29:23.585970       1 server.go:560] external host was not specified, using 10.146.0.2
I0128 08:29:23.600341       1 server.go:147] Version: v1.15.1
I0128 08:29:24.066914       1 plugins.go:158] Loaded 10 mutating admission controller<span class="o">(</span>s<span class="o">)</span> successfully <span class="k">in </span>the following order: NamespaceLifecycle,LimitRanger,ServiceAccount,NodeRestriction,TaintNodesByCondition,Priority,DefaultTolerationSeconds,DefaultStorageClass,StorageObjectInUseProtection,MutatingAdmissionWebhook.

<span class="c"># -f 옵션을 통해 실시간으로 확인 가능하다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> kube-system logs kube-apiserver-k8smaster1 <span class="nt">-f</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/kubernetes/'>Kubernetes</a>, <a href='/categories/kubernetes-administration-course/'>Kubernetes Administration Course</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >kubernetes</a> <a href="/tags/cka/" class="post-tag no-text-decoration" >cka</a> <a href="/tags/lfs458/" class="post-tag no-text-decoration" >LFS458</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[kubernetes-실습] 로깅과 트러블슈팅 : 로그위치와 로그 출력 보기 - ps's Blog&url=https://ps2046.github.io/posts/18.kubernetes_logging_trubleshooting_1/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[kubernetes-실습] 로깅과 트러블슈팅 : 로그위치와 로그 출력 보기 - ps's Blog&u=https://ps2046.github.io/posts/18.kubernetes_logging_trubleshooting_1/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=[kubernetes-실습] 로깅과 트러블슈팅 : 로그위치와 로그 출력 보기 - ps's Blog&url=https://ps2046.github.io/posts/18.kubernetes_logging_trubleshooting_1/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/blog-comments-utterances/">[blog] github blog comments (utterances)</a><li><a href="/posts/17.kubernetes_Scheduling_2/">[kubernetes-실습] Scheduling - Taint를 이용한 pod 배포 관리</a><li><a href="/posts/18.kubernetes_logging_trubleshooting_1/">[kubernetes-실습] 로깅과 트러블슈팅 : 로그위치와 로그 출력 보기</a><li><a href="/posts/19.kubernetes_logging_trubleshooting_2/">[kubernetes-실습] 로깅과 트러블슈팅 : Metrics와 DashBoard</a><li><a href="/posts/20.kubernetes_crd/">[kubernetes-실습] CRD (Custom Resource Definition)</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cka/">cka</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/lfs458/">LFS458</a> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/comments/">comments</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/monitoring/">monitoring</a> <a class="post-tag" href="/tags/system/">system</a> <a class="post-tag" href="/tags/utterances/">utterances</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/17.kubernetes_Scheduling_2/"><div class="card-body"> <span class="timeago small" >Jan 26<i class="unloaded">2021-01-26T08:30:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[kubernetes-실습] Scheduling - Taint를 이용한 pod 배포 관리</h3><div class="text-muted small"><p> Using Taints to Control Pod Deployment taints를 사용하여 어느곳에 pod가 배치되거나 실행을 허용하도록 관리할수 있다. 노드 그룹에 pod들을 할당하여 추가할때 노드 사용을 제한하거나 pod들을 완전히 대피시킬수 있다. 참고 마스터노드가 처음에 NoSchedule taint로 설정되어 있었던것을 기억할 것이다...</p></div></div></a></div><div class="card"> <a href="/posts/19.kubernetes_logging_trubleshooting_2/"><div class="card-body"> <span class="timeago small" >Jan 26<i class="unloaded">2021-01-26T10:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[kubernetes-실습] 로깅과 트러블슈팅 : Metrics와 DashBoard</h3><div class="text-muted small"><p> Metrics 설정 heapster가 deprecation 되면서 Metrics Server 와 통합되어 개발되고 배포되어지고 있다. 그리고 CNCF의 프로젝트중 프로메테우스도 잘 사용되어지고 있다. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 3...</p></div></div></a></div><div class="card"> <a href="/posts/20.kubernetes_crd/"><div class="card-body"> <span class="timeago small" >Jan 26<i class="unloaded">2021-01-26T11:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[kubernetes-실습] CRD (Custom Resource Definition)</h3><div class="text-muted small"><p> Custom Resource Definition 생성 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 5...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/17.kubernetes_Scheduling_2/" class="btn btn-outline-primary" prompt="Older"><p>[kubernetes-실습] Scheduling - Taint를 이용한 pod 배포 관리</p></a> <a href="/posts/19.kubernetes_logging_trubleshooting_2/" class="btn btn-outline-primary" prompt="Newer"><p>[kubernetes-실습] 로깅과 트러블슈팅 : Metrics와 DashBoard</p></a></div><script src="https://utteranc.es/client.js" repo="ps2046/ps2046-github-io-comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async> </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://ps2046.github.io">ps.jang</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/cka/">cka</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/lfs458/">LFS458</a> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/comments/">comments</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/monitoring/">monitoring</a> <a class="post-tag" href="/tags/system/">system</a> <a class="post-tag" href="/tags/utterances/">utterances</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://ps2046.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-158837927-2"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-158837927-2'); }); </script>
