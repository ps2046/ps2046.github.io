<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="[kubernetes-실습] Service Resource" /><meta property="og:locale" content="en" /><meta name="description" content="kubernetes 인증 시험(CKA)에 대비하기 위해 실습을 해보도록 한다." /><meta property="og:description" content="kubernetes 인증 시험(CKA)에 대비하기 위해 실습을 해보도록 한다." /><link rel="canonical" href="https://ps2046.github.io/posts/11.kubernetes_Service_Resource/" /><meta property="og:url" content="https://ps2046.github.io/posts/11.kubernetes_Service_Resource/" /><meta property="og:site_name" content="ps’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-01-26T05:40:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[kubernetes-실습] Service Resource" /><meta name="twitter:site" content="@ps2046" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"kubernetes 인증 시험(CKA)에 대비하기 위해 실습을 해보도록 한다.","headline":"[kubernetes-실습] Service Resource","dateModified":"2021-08-26T00:00:00+09:00","url":"https://ps2046.github.io/posts/11.kubernetes_Service_Resource/","datePublished":"2021-01-26T05:40:00+09:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://ps2046.github.io/posts/11.kubernetes_Service_Resource/"},"@context":"https://schema.org"}</script><title>[kubernetes-실습] Service Resource | ps's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ps's Blog"><meta name="application-name" content="ps's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7635228999568716" crossorigin="anonymous"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/11029548?s=400&u=5ebc191faa53e931968ec2ed98bd7c7b68136c71&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">ps's Blog</a></div><div class="site-subtitle font-italic">System Engineer & Developer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/ps2046" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/ps2046" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ps2046.jang','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[kubernetes-실습] Service Resource</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[kubernetes-실습] Service Resource</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> ps.jang </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Jan 26, 2021, 5:40 AM +0900" >Jan 26<i class="unloaded">2021-01-26T05:40:00+09:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, Aug 26, 2021, 12:00 AM +0000" >Aug 26<i class="unloaded">2021-08-26T00:00:00+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1406 words">7 min read</span></div></div><div class="post-content"><h2 id="deploy-a-new-service">Deploy A new Service</h2><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
</pre><td class="rouge-code"><pre><span class="c"># nginx deployment 배포를 위한 yaml 파일 준비</span>
ps0107@k8smaster1:~<span class="nv">$ </span>vi nginx-one.yaml 
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: nginx-one
  labels:
    system: secondary
  namespace: accounting
spec:
  replicas: 2
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - image: nginx:1.11.1
        imagePullPolicy: Always
        name: nginx
        ports:
        - containerPort: 8080 <span class="c">#-&gt; 포트는 8080으로 지정</span>
          protocol: TCP
      nodeSelector: <span class="c">#-&gt; nodeSelector는 secondOne으로 지정</span>
        system: secondOne
 
<span class="c"># 현재 node에 설정된 라벨 확인</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl get nodes <span class="nt">--show-labels</span>
NAME         STATUS   ROLES    AGE     VERSION   LABELS
k8smaster1   Ready    master   5d21h   v1.15.1   beta.kubernetes.io/arch<span class="o">=</span>amd64,beta.kubernetes.io/os<span class="o">=</span>linux,kubernetes.io/arch<span class="o">=</span>amd64,kubernetes.io/hostname<span class="o">=</span>k8smaster1,kubernetes.io/os<span class="o">=</span>linux,node-role.kubernetes.io/master<span class="o">=</span>
k8sworker1   Ready    &lt;none&gt;   5d21h   v1.15.1   beta.kubernetes.io/arch<span class="o">=</span>amd64,beta.kubernetes.io/os<span class="o">=</span>linux,kubernetes.io/arch<span class="o">=</span>amd64,kubernetes.io/hostname<span class="o">=</span>k8sworker1,kubernetes.io/os<span class="o">=</span>linux

<span class="c"># yaml파일로 생성하려 시도하는데 namespace 가 없어서 실패</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl create <span class="nt">-f</span> nginx-one.yaml
Error from server <span class="o">(</span>NotFound<span class="o">)</span>: error when creating <span class="s2">"nginx-one.yaml"</span>: namespaces <span class="s2">"accounting"</span> not found

<span class="c"># namespace 생성</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl create ns accounting
namespace/accounting created

<span class="c"># 다시 nginx-one deployment 배포</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl create <span class="nt">-f</span> nginx-one.yaml 
deployment.extensions/nginx-one created

<span class="c"># 생성된 pod 확인</span>
<span class="c"># 두개의 pod 가 accounting namespace에 생성됨을 확인, 그러나 상태가 pendding 상태임</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> accounting get pods
NAME                         READY   STATUS    RESTARTS   AGE
nginx-one-575db47668-fcgpf   0/1     Pending   0          19s
nginx-one-575db47668-mng7p   0/1     Pending   0          19s

<span class="c"># 생성된 pod의 상세 내용 확인</span>
<span class="c"># 자세한 내용을 보면 아랫쪽 Events 에 FailedScheduling 을 볼 수도 있다. </span>
<span class="c"># 왜냐하면 node selector 가 secondOne을 찾는데 없어서 warning이 발생했다</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> accounting describe pod nginx-one-575db47668-fcgpf 
Name:           nginx-one-575db47668-fcgpf
Namespace:      accounting
Priority:       0
Node:           &lt;none&gt;
Labels:         <span class="nv">app</span><span class="o">=</span>nginx
                pod-template-hash<span class="o">=</span>575db47668
Annotations:    &lt;none&gt;
Status:         Pending
IP:             
Controlled By:  ReplicaSet/nginx-one-575db47668
Containers:
  nginx:
    Image:        nginx:1.11.1
    Port:         8080/TCP
    Host Port:    0/TCP
    Environment:  &lt;none&gt;
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-m2wzl <span class="o">(</span>ro<span class="o">)</span>
Conditions:
  Type           Status
  PodScheduled   False 
Volumes:
  default-token-m2wzl:
    Type:        Secret <span class="o">(</span>a volume populated by a Secret<span class="o">)</span>
    SecretName:  default-token-m2wzl
    Optional:    <span class="nb">false
</span>QoS Class:       BestEffort
Node-Selectors:  <span class="nv">system</span><span class="o">=</span>secondOne
Tolerations:     node.kubernetes.io/not-ready:NoExecute <span class="k">for </span>300s
                 node.kubernetes.io/unreachable:NoExecute <span class="k">for </span>300s
Events:
  Type     Reason            Age                From               Message
  <span class="nt">----</span>     <span class="nt">------</span>            <span class="nt">----</span>               <span class="nt">----</span>               <span class="nt">-------</span>
  Warning  FailedScheduling  61s <span class="o">(</span>x2 over 61s<span class="o">)</span>  default-scheduler  0/2 nodes are available: 2 node<span class="o">(</span>s<span class="o">)</span> did not match node selector.

<span class="c"># 해결하기 위해 노드에 label 부여해준다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl label node k8sworker1 <span class="nv">system</span><span class="o">=</span>secondOne
node/k8sworker1 labeled

<span class="c"># 노드에 부여된 라벨을 확인한다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl get nodes <span class="nt">--show-labels</span>
NAME         STATUS   ROLES    AGE     VERSION   LABELS
k8smaster1   Ready    master   5d21h   v1.15.1   beta.kubernetes.io/arch<span class="o">=</span>amd64,beta.kubernetes.io/os<span class="o">=</span>linux,kubernetes.io/arch<span class="o">=</span>amd64,kubernetes.io/hostname<span class="o">=</span>k8smaster1,kubernetes.io/os<span class="o">=</span>linux,node-role.kubernetes.io/master<span class="o">=</span>
k8sworker1   Ready    &lt;none&gt;   5d21h   v1.15.1   beta.kubernetes.io/arch<span class="o">=</span>amd64,beta.kubernetes.io/os<span class="o">=</span>linux,kubernetes.io/arch<span class="o">=</span>amd64,kubernetes.io/hostname<span class="o">=</span>k8sworker1,kubernetes.io/os<span class="o">=</span>linux,system<span class="o">=</span>secondOne

<span class="c"># 다시 pod 상태를 확인해본다. 정상 running 상태로 돌아왔다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> accounting get pods
NAME                         READY   STATUS    RESTARTS   AGE
nginx-one-575db47668-fcgpf   1/1     Running   0          2m40s
nginx-one-575db47668-mng7p   1/1     Running   0          2m40s

<span class="c"># label을 통해 pod를 검색해본다.</span>
<span class="c"># 모든 namespace 에서 app=nginx으로 select</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl get pods <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span>nginx <span class="nt">--all-namespaces</span>
NAMESPACE    NAME                         READY   STATUS    RESTARTS   AGE
accounting   nginx-one-575db47668-fcgpf   1/1     Running   0          3m6s
accounting   nginx-one-575db47668-mng7p   1/1     Running   0          3m6s

<span class="c"># nginx-one을 svc expose 시킨다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> accounting expose deployment nginx-one
service/nginx-one exposed

<span class="c"># nginx-one의 endpoint 확인</span>
<span class="c"># pod 갯수대로 보임. yaml 파일 설정으로 인해 8080 포트로 expose 됨</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> accounting get ep nginx-one
NAME        ENDPOINTS                             AGE
nginx-one   192.168.1.73:8080,192.168.1.74:8080   14s

<span class="c"># curl 테스트 실패 </span>
<span class="c"># 현재 임의로 8080으로 부여했는데 실제 이미지의 오픈 포트로 설정해 줘야 한다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>curl 192.168.1.73:8080
curl: <span class="o">(</span>7<span class="o">)</span> Failed to connect to 192.168.1.73 port 8080: Connection refused

<span class="c"># 실제 이미지 포트인 80으로 리슨되어 있다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>curl 192.168.1.73:80
......
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
.....

<span class="c"># yaml 파일에서 수정한다 (8080-&gt;80)</span>
ps0107@k8smaster1:~<span class="nv">$ </span>vi nginx-one.yaml                                                                                       
....
        ports:
        - containerPort: 80
....

<span class="c"># 다시 deployment를 생성하기 위해 기존것을 삭제한다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> accounting delete deploy nginx-one
deployment.extensions <span class="s2">"nginx-one"</span> deleted

<span class="c"># svc 객체도 삭제후 다시 생성해 줘야 한다.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> accounting delete svc nginx-one
service <span class="s2">"nginx-one"</span> deleted

<span class="c"># 수정된 내용으로 deployment 생성</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl create <span class="nt">-f</span> nginx-one.yaml 
deployment.extensions/nginx-one created

<span class="c"># 다시 svc expose 해줌.</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> accounting expose deployment nginx-one 
service/nginx-one exposed

<span class="c"># endpoint 확인</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> accounting get ep
NAME        ENDPOINTS                         AGE
nginx-one   192.168.1.75:80,192.168.1.76:80   22s

<span class="c"># 80으로 서비스 테스트 이상없음</span>
ps0107@k8smaster1:~<span class="nv">$ </span>curl 192.168.1.75:80
....
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
....
</pre></table></code></div></div><hr /><h2 id="nodeport-설정">NodePort 설정</h2><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre><span class="c"># service-lab이라는 이름으로 NodePort expose</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> accounting expose deployment nginx-one <span class="nt">--type</span><span class="o">=</span>NodePort <span class="nt">--name</span><span class="o">=</span>service-lab
service/service-lab exposed

<span class="c"># accounting namespace의 service 들의 정보 확인</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> accounting describe services
Name:              nginx-one
Namespace:         accounting
Labels:            <span class="nv">system</span><span class="o">=</span>secondary
Annotations:       &lt;none&gt;
Selector:          <span class="nv">app</span><span class="o">=</span>nginx
Type:              ClusterIP
IP:                10.107.173.54
Port:              &lt;<span class="nb">unset</span><span class="o">&gt;</span>  80/TCP
TargetPort:        80/TCP
Endpoints:         192.168.1.75:80,192.168.1.76:80
Session Affinity:  None
Events:            &lt;none&gt;


Name:                     service-lab
Namespace:                accounting
Labels:                   <span class="nv">system</span><span class="o">=</span>secondary
Annotations:              &lt;none&gt;
Selector:                 <span class="nv">app</span><span class="o">=</span>nginx
Type:                     NodePort
IP:                       10.98.40.253
Port:                     &lt;<span class="nb">unset</span><span class="o">&gt;</span>  80/TCP
TargetPort:               80/TCP
NodePort:                 &lt;<span class="nb">unset</span><span class="o">&gt;</span>  30250/TCP
Endpoints:                192.168.1.75:80,192.168.1.76:80
Session Affinity:         None
External Traffic Policy:  Cluster
Events:                   &lt;none&gt;

<span class="c"># 클러스터의 외부 ip 주소 알아보자 </span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl cluster-info
Kubernetes master is running at https://k8smaster:6443
KubeDNS is running at https://k8smaster:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use <span class="s1">'kubectl cluster-info dump'</span><span class="nb">.</span>

<span class="c"># node port로 테스트 확인 (현재 master노드도 worker 노드로 사용중이다.)</span>
ps0107@k8smaster1:~<span class="nv">$ </span>curl http://k8smaster:30250
.....
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
.....
</pre></table></code></div></div><hr /><h2 id="label을-사용하여-resource-관리">Label을 사용하여 Resource 관리</h2><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="c"># 전체 namespace에서 app=nginx 로 라벨링 된 pod 들을 삭제</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl delete pods <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span>nginx <span class="nt">--all-namespaces</span>
pod <span class="s2">"nginx-one-8699d6df6d-56z6z"</span> deleted
pod <span class="s2">"nginx-one-8699d6df6d-794cq"</span> deleted

<span class="c"># accounting namespace에서 app=nginx 라벨링된 pod 삭제</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> accounting delete pods <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span>nginx
pod <span class="s2">"nginx-one-8699d6df6d-4d4b7"</span> deleted
pod <span class="s2">"nginx-one-8699d6df6d-8dv9k"</span> deleted

ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> accounting get pods
NAME                         READY   STATUS    RESTARTS   AGE
nginx-one-8699d6df6d-5k4zn   1/1     Running   0          13s
nginx-one-8699d6df6d-d5kff   1/1     Running   0          13s

<span class="c"># nginx-one  deployment에 라벨 확인</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl <span class="nt">-n</span> accounting get deploy <span class="nt">--show-labels</span>
NAME        READY   UP-TO-DATE   AVAILABLE   AGE   LABELS
nginx-one   2/2     2            2           30m   <span class="nv">system</span><span class="o">=</span>secondary

<span class="c"># node 에 system 이라는 label 삭제</span>
ps0107@k8smaster1:~<span class="nv">$ </span>kubectl label nodes k8sworker1 system-
node/k8sworker1 labeled

ps0107@k8smaster1:~<span class="nv">$ </span>kubectl get nodes <span class="nt">--show-labels</span>
NAME         STATUS   ROLES    AGE     VERSION   LABELS
k8smaster1   Ready    master   5d22h   v1.15.1   beta.kubernetes.io/arch<span class="o">=</span>amd64,beta.kubernetes.io/os<span class="o">=</span>linux,kubernetes.io/arch<span class="o">=</span>amd64,kubernetes.io/hostname<span class="o">=</span>k8smaster1,kubernetes.io/os<span class="o">=</span>linux,node-role.kubernetes.io/master<span class="o">=</span>
k8sworker1   Ready    &lt;none&gt;   5d21h   v1.15.1   beta.kubernetes.io/arch<span class="o">=</span>amd64,beta.kubernetes.io/os<span class="o">=</span>linux,kubernetes.io/arch<span class="o">=</span>amd64,kubernetes.io/hostname<span class="o">=</span>k8sworker1,kubernetes.io/os<span class="o">=</span>linux
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/kubernetes/'>Kubernetes</a>, <a href='/categories/kubernetes-administration-course/'>Kubernetes Administration Course</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >kubernetes</a> <a href="/tags/cka/" class="post-tag no-text-decoration" >cka</a> <a href="/tags/lfs458/" class="post-tag no-text-decoration" >LFS458</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[kubernetes-실습] Service Resource - ps's Blog&url=https://ps2046.github.io/posts/11.kubernetes_Service_Resource/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[kubernetes-실습] Service Resource - ps's Blog&u=https://ps2046.github.io/posts/11.kubernetes_Service_Resource/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=[kubernetes-실습] Service Resource - ps's Blog&url=https://ps2046.github.io/posts/11.kubernetes_Service_Resource/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/blog-comments-utterances/">[blog] github blog comments (utterances)</a><li><a href="/posts/17.kubernetes_Scheduling_2/">[kubernetes-실습] Scheduling - Taint를 이용한 pod 배포 관리</a><li><a href="/posts/18.kubernetes_logging_trubleshooting_1/">[kubernetes-실습] 로깅과 트러블슈팅 : 로그위치와 로그 출력 보기</a><li><a href="/posts/19.kubernetes_logging_trubleshooting_2/">[kubernetes-실습] 로깅과 트러블슈팅 : Metrics와 DashBoard</a><li><a href="/posts/20.kubernetes_crd/">[kubernetes-실습] CRD (Custom Resource Definition)</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cka/">cka</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/lfs458/">LFS458</a> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/comments/">comments</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/monitoring/">monitoring</a> <a class="post-tag" href="/tags/system/">system</a> <a class="post-tag" href="/tags/utterances/">utterances</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/17.kubernetes_Scheduling_2/"><div class="card-body"> <span class="timeago small" >Jan 26<i class="unloaded">2021-01-26T08:30:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[kubernetes-실습] Scheduling - Taint를 이용한 pod 배포 관리</h3><div class="text-muted small"><p> Using Taints to Control Pod Deployment taints를 사용하여 어느곳에 pod가 배치되거나 실행을 허용하도록 관리할수 있다. 노드 그룹에 pod들을 할당하여 추가할때 노드 사용을 제한하거나 pod들을 완전히 대피시킬수 있다. 참고 마스터노드가 처음에 NoSchedule taint로 설정되어 있었던것을 기억할 것이다...</p></div></div></a></div><div class="card"> <a href="/posts/18.kubernetes_logging_trubleshooting_1/"><div class="card-body"> <span class="timeago small" >Jan 26<i class="unloaded">2021-01-26T09:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[kubernetes-실습] 로깅과 트러블슈팅 : 로그위치와 로그 출력 보기</h3><div class="text-muted small"><p> 로그 파일들의 위치 알아보기 다양한 로그 파일과 명령 출력 이외에도 journalctl을 사용하여 노드 관점에서 로그를 볼 수 있다. 우리는 로그 파일의 공통적인 위치를 보고, 컨테이너 로그를 보는 명령을 볼 것이다. 다른 컨테이너의 로그를 pod에 적재하는데 전용으로 사용되는 sidecar container의 사용과 같은 다른 로깅 ...</p></div></div></a></div><div class="card"> <a href="/posts/19.kubernetes_logging_trubleshooting_2/"><div class="card-body"> <span class="timeago small" >Jan 26<i class="unloaded">2021-01-26T10:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[kubernetes-실습] 로깅과 트러블슈팅 : Metrics와 DashBoard</h3><div class="text-muted small"><p> Metrics 설정 heapster가 deprecation 되면서 Metrics Server 와 통합되어 개발되고 배포되어지고 있다. 그리고 CNCF의 프로젝트중 프로메테우스도 잘 사용되어지고 있다. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 3...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/10.Managing_State_with_Deployments/" class="btn btn-outline-primary" prompt="Older"><p>[kubernetes-실습] Managing State with Deployments</p></a> <a href="/posts/12.kubernetes_Volumes_and_Data_ConfigMap/" class="btn btn-outline-primary" prompt="Newer"><p>[kubernetes-실습] Volumes and Data : ConfigMap 간단 테스트</p></a></div><script src="https://utteranc.es/client.js" repo="ps2046/ps2046-github-io-comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async> </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://ps2046.github.io">ps.jang</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/cka/">cka</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/lfs458/">LFS458</a> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/comments/">comments</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/monitoring/">monitoring</a> <a class="post-tag" href="/tags/system/">system</a> <a class="post-tag" href="/tags/utterances/">utterances</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://ps2046.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-158837927-2"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-158837927-2'); }); </script>
